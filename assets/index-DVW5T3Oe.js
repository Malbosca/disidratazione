(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=e(l);fetch(l.href,n)}})();const Ir=!1;var Ge=Array.isArray,Yi=Array.prototype.indexOf,yr=Array.from,Xr=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,Bi=Object.getOwnPropertyDescriptors,Gi=Object.prototype,Ji=Array.prototype,Zr=Object.getPrototypeOf,Or=Object.isExtensible;const Wa=()=>{};function ti(t){for(var a=0;a<t.length;a++)t[a]()}const Ea=2,ai=4,Je=8,wr=16,Ka=32,de=64,Me=128,wa=256,Fe=512,ha=1024,Ia=2048,re=4096,Ra=8192,We=16384,Wi=32768,kr=65536,Qi=1<<19,ei=1<<20,_r=1<<21,_e=Symbol("$state");function ri(t){return t===this.v}function ii(t,a){return t!=t?a==a:t!==a||t!==null&&typeof t=="object"||typeof t=="function"}function oi(t){return!ii(t,this.v)}function Xi(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Zi(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function to(t){throw new Error("https://svelte.dev/e/effect_orphan")}function ao(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function eo(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ro(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function io(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let oo=!1;const zr=1,$r=2,ni=4,no=8,so=16,lo=1,co=2,ma=Symbol(),vo="http://www.w3.org/1999/xhtml";function uo(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let xa=null;function Mr(t){xa=t}function Pa(t,a=!1,e){var s=xa={p:xa,c:null,d:!1,e:null,m:!1,s:t,x:null,l:null};bi(()=>{s.d=!0})}function Sa(t){const a=xa;if(a!==null){const c=a.e;if(c!==null){var e=Ot,s=Dt;a.e=null;try{for(var l=0;l<c.length;l++){var n=c[l];Za(n.effect),Oa(n.reaction),Ze(n.fn)}}finally{Za(e),Oa(s)}}xa=a.p,a.m=!0}return{}}function si(){return!0}function fa(t){if(typeof t!="object"||t===null||_e in t)return t;const a=Zr(t);if(a!==Gi&&a!==Ji)return t;var e=new Map,s=Ge(t),l=ht(0),n=Dt,c=u=>{var d=Dt;Oa(n);var v=u();return Oa(d),v};return s&&e.set("length",ht(t.length)),new Proxy(t,{defineProperty(u,d,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&eo();var b=e.get(d);return b===void 0?(b=c(()=>ht(v.value)),e.set(d,b)):Y(b,c(()=>fa(v.value))),!0},deleteProperty(u,d){var v=e.get(d);if(v===void 0)d in u&&(e.set(d,c(()=>ht(ma))),ur(l));else{if(s&&typeof d=="string"){var b=e.get("length"),f=Number(d);Number.isInteger(f)&&f<b.v&&Y(b,f)}Y(v,ma),ur(l)}return!0},get(u,d,v){var h;if(d===_e)return t;var b=e.get(d),f=d in u;if(b===void 0&&(!f||(h=fe(u,d))!=null&&h.writable)&&(b=c(()=>ht(fa(f?u[d]:ma))),e.set(d,b)),b!==void 0){var p=r(b);return p===ma?void 0:p}return Reflect.get(u,d,v)},getOwnPropertyDescriptor(u,d){var v=Reflect.getOwnPropertyDescriptor(u,d);if(v&&"value"in v){var b=e.get(d);b&&(v.value=r(b))}else if(v===void 0){var f=e.get(d),p=f==null?void 0:f.v;if(f!==void 0&&p!==ma)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return v},has(u,d){var p;if(d===_e)return!0;var v=e.get(d),b=v!==void 0&&v.v!==ma||Reflect.has(u,d);if(v!==void 0||Ot!==null&&(!b||(p=fe(u,d))!=null&&p.writable)){v===void 0&&(v=c(()=>ht(b?fa(u[d]):ma)),e.set(d,v));var f=r(v);if(f===ma)return!1}return b},set(u,d,v,b){var D;var f=e.get(d),p=d in u;if(s&&d==="length")for(var h=v;h<f.v;h+=1){var y=e.get(h+"");y!==void 0?Y(y,ma):h in u&&(y=c(()=>ht(ma)),e.set(h+"",y))}f===void 0?(!p||(D=fe(u,d))!=null&&D.writable)&&(f=c(()=>ht(void 0)),Y(f,c(()=>fa(v))),e.set(d,f)):(p=f.v!==ma,Y(f,c(()=>fa(v))));var L=Reflect.getOwnPropertyDescriptor(u,d);if(L!=null&&L.set&&L.set.call(b,v),!p){if(s&&typeof d=="string"){var A=e.get("length"),N=Number(d);Number.isInteger(N)&&N>=A.v&&Y(A,N+1)}ur(l)}return!0},ownKeys(u){r(l);var d=Reflect.ownKeys(u).filter(f=>{var p=e.get(f);return p===void 0||p.v!==ma});for(var[v,b]of e)b.v!==ma&&!(v in u)&&d.push(v);return d},setPrototypeOf(){ro()}})}function ur(t,a=1){Y(t,t.v+a)}function Fr(t){try{if(t!==null&&typeof t=="object"&&_e in t)return t[_e]}catch{}return t}function po(t,a){return Object.is(Fr(t),Fr(a))}function Pr(t){var a=Ea|Ia,e=Dt!==null&&(Dt.f&Ea)!==0?Dt:null;return Ot===null||e!==null&&(e.f&wa)!==0?a|=wa:Ot.f|=ei,{ctx:xa,deps:null,effects:null,equals:ri,f:a,fn:t,reactions:null,rv:0,v:null,wv:0,parent:e??Ot}}function Rt(t){const a=Pr(t);return zi(a),a}function fo(t){const a=Pr(t);return a.equals=oi,a}function li(t){var a=t.effects;if(a!==null){t.effects=null;for(var e=0;e<a.length;e+=1)Xa(a[e])}}function _o(t){for(var a=t.parent;a!==null;){if((a.f&Ea)===0)return a;a=a.parent}return null}function ci(t){var a,e=Ot;Za(_o(t));try{li(t),a=Ti(t)}finally{Za(e)}return a}function vi(t){var a=ci(t),e=(Ga||(t.f&wa)!==0)&&t.deps!==null?re:ha;Da(t,e),t.equals(a)||(t.v=a,t.wv=Pi())}const he=new Map;function Ne(t,a){var e={f:0,v:t,reactions:null,equals:ri,rv:0,wv:0};return e}function ht(t,a){const e=Ne(t);return zi(e),e}function di(t,a=!1){const e=Ne(t);return a||(e.equals=oi),e}function Y(t,a,e=!1){Dt!==null&&!La&&si()&&(Dt.f&(Ea|wr))!==0&&!(_a!=null&&_a.includes(t))&&io();let s=e?fa(a):a;return br(t,s)}function br(t,a){if(!t.equals(a)){var e=t.v;we?he.set(t,a):he.set(t,e),t.v=a,(t.f&Ea)!==0&&((t.f&Ia)!==0&&ci(t),Da(t,(t.f&wa)===0?ha:re)),t.wv=Pi(),ui(t,Ia),Ot!==null&&(Ot.f&ha)!==0&&(Ot.f&(Ka|de))===0&&(za===null?So([t]):za.push(t))}return a}function ui(t,a){var e=t.reactions;if(e!==null)for(var s=e.length,l=0;l<s;l++){var n=e[l],c=n.f;(c&Ia)===0&&(Da(n,a),(c&(ha|wa))!==0&&((c&Ea)!==0?ui(n,re):ar(n)))}}function bo(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let go=!1;var Nr,pi,fi,_i;function mo(){if(Nr===void 0){Nr=window,pi=/Firefox/.test(navigator.userAgent);var t=Element.prototype,a=Node.prototype,e=Text.prototype;fi=fe(a,"firstChild").get,_i=fe(a,"nextSibling").get,Or(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Or(e)&&(e.__t=void 0)}}function Qe(t=""){return document.createTextNode(t)}function Re(t){return fi.call(t)}function Xe(t){return _i.call(t)}function i(t,a){return Re(t)}function Qa(t,a){{var e=Re(t);return e instanceof Comment&&e.data===""?Xe(e):e}}function o(t,a=1,e=!1){let s=t;for(;a--;)s=Xe(s);return s}function xo(t){t.textContent=""}function ho(t){Ot===null&&Dt===null&&to(),Dt!==null&&(Dt.f&wa)!==0&&Ot===null&&Zi(),we&&Xi()}function yo(t,a){var e=a.last;e===null?a.last=a.first=t:(e.next=t,t.prev=e,a.last=t)}function ue(t,a,e,s=!0){var l=Ot,n={ctx:xa,deps:null,nodes_start:null,nodes_end:null,f:t|Ia,first:null,fn:a,last:null,next:null,parent:l,prev:null,teardown:null,transitions:null,wv:0};if(e)try{Ar(n),n.f|=Wi}catch(d){throw Xa(n),d}else a!==null&&ar(n);var c=e&&n.deps===null&&n.first===null&&n.nodes_start===null&&n.teardown===null&&(n.f&(ei|Me))===0;if(!c&&s&&(l!==null&&yo(n,l),Dt!==null&&(Dt.f&Ea)!==0)){var u=Dt;(u.effects??(u.effects=[])).push(n)}return n}function bi(t){const a=ue(Je,null,!1);return Da(a,ha),a.teardown=t,a}function gi(t){ho();var a=Ot!==null&&(Ot.f&Ka)!==0&&xa!==null&&!xa.m;if(a){var e=xa;(e.e??(e.e=[])).push({fn:t,effect:Ot,reaction:Dt})}else{var s=Ze(t);return s}}function wo(t){const a=ue(de,t,!0);return(e={})=>new Promise(s=>{e.outro?qe(a,()=>{Xa(a),s(void 0)}):(Xa(a),s(void 0))})}function Ze(t){return ue(ai,t,!1)}function mi(t){return ue(Je,t,!0)}function R(t,a=[],e=Pr){const s=a.map(e);return Sr(()=>t(...s.map(r)))}function Sr(t,a=0){return ue(Je|wr|a,t,!0)}function ye(t,a=!0){return ue(Je|Ka,t,!0,a)}function xi(t){var a=t.teardown;if(a!==null){const e=we,s=Dt;Rr(!0),Oa(null);try{a.call(null)}finally{Rr(e),Oa(s)}}}function hi(t,a=!1){var e=t.first;for(t.first=t.last=null;e!==null;){var s=e.next;(e.f&de)!==0?e.parent=null:Xa(e,a),e=s}}function ko(t){for(var a=t.first;a!==null;){var e=a.next;(a.f&Ka)===0&&Xa(a),a=e}}function Xa(t,a=!0){var e=!1;(a||(t.f&Qi)!==0)&&t.nodes_start!==null&&(zo(t.nodes_start,t.nodes_end),e=!0),hi(t,a&&!e),He(t,0),Da(t,We);var s=t.transitions;if(s!==null)for(const n of s)n.stop();xi(t);var l=t.parent;l!==null&&l.first!==null&&yi(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function zo(t,a){for(;t!==null;){var e=t===a?null:Xe(t);t.remove(),t=e}}function yi(t){var a=t.parent,e=t.prev,s=t.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),a!==null&&(a.first===t&&(a.first=s),a.last===t&&(a.last=e))}function qe(t,a){var e=[];Tr(t,e,!0),wi(e,()=>{Xa(t),a&&a()})}function wi(t,a){var e=t.length;if(e>0){var s=()=>--e||a();for(var l of t)l.out(s)}else a()}function Tr(t,a,e){if((t.f&Ra)===0){if(t.f^=Ra,t.transitions!==null)for(const c of t.transitions)(c.is_global||e)&&a.push(c);for(var s=t.first;s!==null;){var l=s.next,n=(s.f&kr)!==0||(s.f&Ka)!==0;Tr(s,a,n?e:!1),s=l}}}function Ke(t){ki(t,!0)}function ki(t,a){if((t.f&Ra)!==0){t.f^=Ra,(t.f&ha)===0&&(t.f^=ha),ke(t)&&(Da(t,Ia),ar(t));for(var e=t.first;e!==null;){var s=e.next,l=(e.f&kr)!==0||(e.f&Ka)!==0;ki(e,l?a:!1),e=s}if(t.transitions!==null)for(const n of t.transitions)(n.is_global||a)&&n.in()}}let je=[];function $o(){var t=je;je=[],ti(t)}function Po(t){je.length===0&&queueMicrotask($o),je.push(t)}let Ie=!1,gr=!1,Ue=null,ee=!1,we=!1;function Rr(t){we=t}let Oe=[];let Dt=null,La=!1;function Oa(t){Dt=t}let Ot=null;function Za(t){Ot=t}let _a=null;function zi(t){Dt!==null&&Dt.f&_r&&(_a===null?_a=[t]:_a.push(t))}let pa=null,ya=0,za=null;function So(t){za=t}let $i=1,Ve=0,Ga=!1;function Pi(){return++$i}function ke(t){var f;var a=t.f;if((a&Ia)!==0)return!0;if((a&re)!==0){var e=t.deps,s=(a&wa)!==0;if(e!==null){var l,n,c=(a&Fe)!==0,u=s&&Ot!==null&&!Ga,d=e.length;if(c||u){var v=t,b=v.parent;for(l=0;l<d;l++)n=e[l],(c||!((f=n==null?void 0:n.reactions)!=null&&f.includes(v)))&&(n.reactions??(n.reactions=[])).push(v);c&&(v.f^=Fe),u&&b!==null&&(b.f&wa)===0&&(v.f^=wa)}for(l=0;l<d;l++)if(n=e[l],ke(n)&&vi(n),n.wv>t.wv)return!0}(!s||Ot!==null&&!Ga)&&Da(t,ha)}return!1}function To(t,a){for(var e=a;e!==null;){if((e.f&Me)!==0)try{e.fn(t);return}catch{e.f^=Me}e=e.parent}throw Ie=!1,t}function qr(t){return(t.f&We)===0&&(t.parent===null||(t.parent.f&Me)===0)}function tr(t,a,e,s){if(Ie){if(e===null&&(Ie=!1),qr(a))throw t;return}if(e!==null&&(Ie=!0),To(t,a),qr(a))throw t}function Si(t,a,e=!0){var s=t.reactions;if(s!==null)for(var l=0;l<s.length;l++){var n=s[l];_a!=null&&_a.includes(t)||((n.f&Ea)!==0?Si(n,a,!1):a===n&&(e?Da(n,Ia):(n.f&ha)!==0&&Da(n,re),ar(n)))}}function Ti(t){var h;var a=pa,e=ya,s=za,l=Dt,n=Ga,c=_a,u=xa,d=La,v=t.f;pa=null,ya=0,za=null,Ga=(v&wa)!==0&&(La||!ee||Dt===null),Dt=(v&(Ka|de))===0?t:null,_a=null,Mr(t.ctx),La=!1,Ve++,t.f|=_r;try{var b=(0,t.fn)(),f=t.deps;if(pa!==null){var p;if(He(t,ya),f!==null&&ya>0)for(f.length=ya+pa.length,p=0;p<pa.length;p++)f[ya+p]=pa[p];else t.deps=f=pa;if(!Ga)for(p=ya;p<f.length;p++)((h=f[p]).reactions??(h.reactions=[])).push(t)}else f!==null&&ya<f.length&&(He(t,ya),f.length=ya);if(si()&&za!==null&&!La&&f!==null&&(t.f&(Ea|re|Ia))===0)for(p=0;p<za.length;p++)Si(za[p],t);return l!==null&&l!==t&&(Ve++,za!==null&&(s===null?s=za:s.push(...za))),b}finally{pa=a,ya=e,za=s,Dt=l,Ga=n,_a=c,Mr(u),La=d,t.f^=_r}}function Ao(t,a){let e=a.reactions;if(e!==null){var s=Yi.call(e,t);if(s!==-1){var l=e.length-1;l===0?e=a.reactions=null:(e[s]=e[l],e.pop())}}e===null&&(a.f&Ea)!==0&&(pa===null||!pa.includes(a))&&(Da(a,re),(a.f&(wa|Fe))===0&&(a.f^=Fe),li(a),He(a,0))}function He(t,a){var e=t.deps;if(e!==null)for(var s=a;s<e.length;s++)Ao(t,e[s])}function Ar(t){var a=t.f;if((a&We)===0){Da(t,ha);var e=Ot,s=xa,l=ee;Ot=t,ee=!0;try{(a&wr)!==0?ko(t):hi(t),xi(t);var n=Ti(t);t.teardown=typeof n=="function"?n:null,t.wv=$i;var c=t.deps,u;Ir&&oo&&t.f&Ia}catch(d){tr(d,t,e,s||t.ctx)}finally{ee=l,Ot=e}}}function Eo(){try{ao()}catch(t){if(Ue!==null)tr(t,Ue,null);else throw t}}function Do(){var t=ee;try{var a=0;for(ee=!0;Oe.length>0;){a++>1e3&&Eo();var e=Oe,s=e.length;Oe=[];for(var l=0;l<s;l++){var n=Co(e[l]);Lo(n)}he.clear()}}finally{gr=!1,ee=t,Ue=null}}function Lo(t){var a=t.length;if(a!==0)for(var e=0;e<a;e++){var s=t[e];if((s.f&(We|Ra))===0)try{ke(s)&&(Ar(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?yi(s):s.fn=null))}catch(l){tr(l,s,null,s.ctx)}}}function ar(t){gr||(gr=!0,queueMicrotask(Do));for(var a=Ue=t;a.parent!==null;){a=a.parent;var e=a.f;if((e&(de|Ka))!==0){if((e&ha)===0)return;a.f^=ha}}Oe.push(a)}function Co(t){for(var a=[],e=t;e!==null;){var s=e.f,l=(s&(Ka|de))!==0,n=l&&(s&ha)!==0;if(!n&&(s&Ra)===0){if((s&ai)!==0)a.push(e);else if(l)e.f^=ha;else try{ke(e)&&Ar(e)}catch(d){tr(d,e,null,e.ctx)}var c=e.first;if(c!==null){e=c;continue}}var u=e.parent;for(e=e.next;e===null&&u!==null;)e=u.next,u=u.parent}return a}function r(t){var a=t.f,e=(a&Ea)!==0;if(Dt!==null&&!La){if(!(_a!=null&&_a.includes(t))){var s=Dt.deps;t.rv<Ve&&(t.rv=Ve,pa===null&&s!==null&&s[ya]===t?ya++:pa===null?pa=[t]:(!Ga||!pa.includes(t))&&pa.push(t))}}else if(e&&t.deps===null&&t.effects===null){var l=t,n=l.parent;n!==null&&(n.f&wa)===0&&(l.f^=wa)}return e&&(l=t,ke(l)&&vi(l)),we&&he.has(t)?he.get(t):t.v}function er(t){var a=La;try{return La=!0,t()}finally{La=a}}const Io=-7169;function Da(t,a){t.f=t.f&Io|a}const Oo=["touchstart","touchmove"];function Mo(t){return Oo.includes(t)}let Kr=!1;function Fo(){Kr||(Kr=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var a;if(!t.defaultPrevented)for(const e of t.target.elements)(a=e.__on_r)==null||a.call(e)})},{capture:!0}))}function No(t){var a=Dt,e=Ot;Oa(null),Za(null);try{return t()}finally{Oa(a),Za(e)}}function Er(t,a,e,s=e){t.addEventListener(a,()=>No(e));const l=t.__on_r;l?t.__on_r=()=>{l(),s(!0)}:t.__on_r=()=>s(!0),Fo()}const Ai=new Set,mr=new Set;function Ma(t){for(var a=0;a<t.length;a++)Ai.add(t[a]);for(var e of mr)e(t)}function Ee(t){var D;var a=this,e=a.ownerDocument,s=t.type,l=((D=t.composedPath)==null?void 0:D.call(t))||[],n=l[0]||t.target,c=0,u=t.__root;if(u){var d=l.indexOf(u);if(d!==-1&&(a===document||a===window)){t.__root=a;return}var v=l.indexOf(a);if(v===-1)return;d<=v&&(c=d)}if(n=l[c]||t.target,n!==a){Xr(t,"currentTarget",{configurable:!0,get(){return n||e}});var b=Dt,f=Ot;Oa(null),Za(null);try{for(var p,h=[];n!==null;){var y=n.assignedSlot||n.parentNode||n.host||null;try{var L=n["__"+s];if(L!=null&&(!n.disabled||t.target===n))if(Ge(L)){var[A,...N]=L;A.apply(n,[t,...N])}else L.call(n,t)}catch(M){p?h.push(M):p=M}if(t.cancelBubble||y===a||y===null)break;n=y}if(p){for(let M of h)queueMicrotask(()=>{throw M});throw p}}finally{t.__root=a,delete t.currentTarget,Oa(b),Za(f)}}}function Ro(t){var a=document.createElement("template");return a.innerHTML=t.replaceAll("<!>","<!---->"),a.content}function Ye(t,a){var e=Ot;e.nodes_start===null&&(e.nodes_start=t,e.nodes_end=a)}function x(t,a){var e=(a&lo)!==0,s=(a&co)!==0,l,n=!t.startsWith("<!>");return()=>{l===void 0&&(l=Ro(n?t:"<!>"+t),e||(l=Re(l)));var c=s||pi?document.importNode(l,!0):l.cloneNode(!0);if(e){var u=Re(c),d=c.lastChild;Ye(u,d)}else Ye(c,c);return c}}function ua(t=""){{var a=Qe(t+"");return Ye(a,a),a}}function Ei(){var t=document.createDocumentFragment(),a=document.createComment(""),e=Qe();return t.append(a,e),Ye(a,e),t}function _(t,a){t!==null&&t.before(a)}function g(t,a){var e=a==null?"":typeof a=="object"?a+"":a;e!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=e,t.nodeValue=e+"")}function qo(t,a){return Ko(t,a)}const ne=new Map;function Ko(t,{target:a,anchor:e,props:s={},events:l,context:n,intro:c=!0}){mo();var u=new Set,d=f=>{for(var p=0;p<f.length;p++){var h=f[p];if(!u.has(h)){u.add(h);var y=Mo(h);a.addEventListener(h,Ee,{passive:y});var L=ne.get(h);L===void 0?(document.addEventListener(h,Ee,{passive:y}),ne.set(h,1)):ne.set(h,L+1)}}};d(yr(Ai)),mr.add(d);var v=void 0,b=wo(()=>{var f=e??a.appendChild(Qe());return ye(()=>{if(n){Pa({});var p=xa;p.c=n}l&&(s.$$events=l),v=t(f,s)||{},n&&Sa()}),()=>{var y;for(var p of u){a.removeEventListener(p,Ee);var h=ne.get(p);--h===0?(document.removeEventListener(p,Ee),ne.delete(p)):ne.set(p,h)}mr.delete(d),f!==e&&((y=f.parentNode)==null||y.removeChild(f))}});return jo.set(v,b),v}let jo=new WeakMap;function T(t,a,[e,s]=[0,0]){var l=t,n=null,c=null,u=ma,d=e>0?kr:0,v=!1;const b=(p,h=!0)=>{v=!0,f(h,p)},f=(p,h)=>{u!==(u=p)&&(u?(n?Ke(n):h&&(n=ye(()=>h(l))),c&&qe(c,()=>{c=null})):(c?Ke(c):h&&(c=ye(()=>h(l,[e+1,s]))),n&&qe(n,()=>{n=null})))};Sr(()=>{v=!1,a(b),v||f(null,null)},d)}function Yt(t,a){return a}function Uo(t,a,e,s){for(var l=[],n=a.length,c=0;c<n;c++)Tr(a[c].e,l,!0);var u=n>0&&l.length===0&&e!==null;if(u){var d=e.parentNode;xo(d),d.append(e),s.clear(),Ha(t,a[0].prev,a[n-1].next)}wi(l,()=>{for(var v=0;v<n;v++){var b=a[v];u||(s.delete(b.k),Ha(t,b.prev,b.next)),Xa(b.e,!u)}})}function Bt(t,a,e,s,l,n=null){var c=t,u={flags:a,items:new Map,first:null},d=(a&ni)!==0;if(d){var v=t;c=v.appendChild(Qe())}var b=null,f=!1,p=fo(()=>{var h=e();return Ge(h)?h:h==null?[]:yr(h)});Sr(()=>{var h=r(p),y=h.length;f&&y===0||(f=y===0,Vo(h,u,c,l,a,s,e),n!==null&&(y===0?b?Ke(b):b=ye(()=>n(c)):b!==null&&qe(b,()=>{b=null})),r(p))})}function Vo(t,a,e,s,l,n,c){var ra,C,w,k;var u=(l&no)!==0,d=(l&(zr|$r))!==0,v=t.length,b=a.items,f=a.first,p=f,h,y=null,L,A=[],N=[],D,M,E,O;if(u)for(O=0;O<v;O+=1)D=t[O],M=n(D,O),E=b.get(M),E!==void 0&&((ra=E.a)==null||ra.measure(),(L??(L=new Set)).add(E));for(O=0;O<v;O+=1){if(D=t[O],M=n(D,O),E=b.get(M),E===void 0){var _t=p?p.e.nodes_start:e;y=Yo(_t,a,y,y===null?a.first:y.next,D,M,O,s,l,c),b.set(M,y),A=[],N=[],p=y.next;continue}if(d&&Ho(E,D,O,l),(E.e.f&Ra)!==0&&(Ke(E.e),u&&((C=E.a)==null||C.unfix(),(L??(L=new Set)).delete(E))),E!==p){if(h!==void 0&&h.has(E)){if(A.length<N.length){var rt=N[0],dt;y=rt.prev;var Wt=A[0],Kt=A[A.length-1];for(dt=0;dt<A.length;dt+=1)jr(A[dt],rt,e);for(dt=0;dt<N.length;dt+=1)h.delete(N[dt]);Ha(a,Wt.prev,Kt.next),Ha(a,y,Wt),Ha(a,Kt,rt),p=rt,y=Kt,O-=1,A=[],N=[]}else h.delete(E),jr(E,p,e),Ha(a,E.prev,E.next),Ha(a,E,y===null?a.first:y.next),Ha(a,y,E),y=E;continue}for(A=[],N=[];p!==null&&p.k!==M;)(p.e.f&Ra)===0&&(h??(h=new Set)).add(p),N.push(p),p=p.next;if(p===null)continue;E=p}A.push(E),y=E,p=E.next}if(p!==null||h!==void 0){for(var Qt=h===void 0?[]:yr(h);p!==null;)(p.e.f&Ra)===0&&Qt.push(p),p=p.next;var it=Qt.length;if(it>0){var va=(l&ni)!==0&&v===0?e:null;if(u){for(O=0;O<it;O+=1)(w=Qt[O].a)==null||w.measure();for(O=0;O<it;O+=1)(k=Qt[O].a)==null||k.fix()}Uo(a,Qt,va,b)}}u&&Po(()=>{var I;if(L!==void 0)for(E of L)(I=E.a)==null||I.apply()}),Ot.first=a.first&&a.first.e,Ot.last=y&&y.e}function Ho(t,a,e,s){(s&zr)!==0&&br(t.v,a),(s&$r)!==0?br(t.i,e):t.i=e}function Yo(t,a,e,s,l,n,c,u,d,v){var b=(d&zr)!==0,f=(d&so)===0,p=b?f?di(l):Ne(l):l,h=(d&$r)===0?c:Ne(c),y={i:h,v:p,k:n,a:null,e:null,prev:e,next:s};try{return y.e=ye(()=>u(t,p,h,v),go),y.e.prev=e&&e.e,y.e.next=s&&s.e,e===null?a.first=y:(e.next=y,e.e.next=y.e),s!==null&&(s.prev=y,s.e.prev=y.e),y}finally{}}function jr(t,a,e){for(var s=t.next?t.next.e.nodes_start:e,l=a?a.e.nodes_start:e,n=t.e.nodes_start;n!==s;){var c=Xe(n);l.before(n),n=c}}function Ha(t,a,e){a===null?t.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}function Bo(t,a,e){var s=t==null?"":""+t;return s===""?null:s}function na(t,a,e,s,l,n){var c=t.__className;if(c!==e||c===void 0){var u=Bo(e);u==null?t.removeAttribute("class"):t.className=u,t.__className=e}return n}const Go=Symbol("is custom element"),Jo=Symbol("is html");function Wo(t,a){var e=Di(t);e.checked!==(e.checked=a??void 0)&&(t.checked=a)}function Qo(t,a,e,s){var l=Di(t);l[a]!==(l[a]=e)&&(e==null?t.removeAttribute(a):typeof e!="string"&&Xo(t).includes(a)?t[a]=e:t.setAttribute(a,e))}function Di(t){return t.__attributes??(t.__attributes={[Go]:t.nodeName.includes("-"),[Jo]:t.namespaceURI===vo})}var Ur=new Map;function Xo(t){var a=Ur.get(t.nodeName);if(a)return a;Ur.set(t.nodeName,a=[]);for(var e,s=t,l=Element.prototype;l!==s;){e=Bi(s);for(var n in e)e[n].set&&a.push(n);s=Zr(s)}return a}function pt(t,a,e=a){Er(t,"input",s=>{var l=s?t.defaultValue:t.value;if(l=pr(t)?fr(l):l,e(l),l!==(l=a())){var n=t.selectionStart,c=t.selectionEnd;t.value=l??"",c!==null&&(t.selectionStart=n,t.selectionEnd=Math.min(c,t.value.length))}}),er(a)==null&&t.value&&e(pr(t)?fr(t.value):t.value),mi(()=>{var s=a();pr(t)&&s===fr(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Li(t,a,e=a){Er(t,"change",s=>{var l=s?t.defaultChecked:t.checked;e(l)}),er(a)==null&&e(t.checked),mi(()=>{var s=a();t.checked=!!s})}function pr(t){var a=t.type;return a==="number"||a==="range"}function fr(t){return t===""?null:+t}function Ci(t,a,e){if(t.multiple)return a==null?void 0:Ge(a)?tn(t,a):bo();for(var s of t.options){var l=ge(s);if(po(l,a)){s.selected=!0;return}}(!e||a!==void 0)&&(t.selectedIndex=-1)}function Zo(t,a){Ze(()=>{var e=new MutationObserver(()=>{var s=t.__value;Ci(t,s)});return e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function be(t,a,e=a){var s=!0;Er(t,"change",l=>{var n=l?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(n),ge);else{var u=t.querySelector(n)??t.querySelector("option:not([disabled])");c=u&&ge(u)}e(c)}),Ze(()=>{var l=a();if(Ci(t,l,s),s&&l===void 0){var n=t.querySelector(":checked");n!==null&&(l=ge(n),e(l))}t.__value=l,s=!1}),Zo(t)}function tn(t,a){for(var e of t.options)e.selected=a.includes(ge(e))}function ge(t){return"__value"in t?t.__value:t.value}function Dr(t,a,e){if(t==null)return a(void 0),e&&e(void 0),Wa;const s=er(()=>t.subscribe(a,e));return s.unsubscribe?()=>s.unsubscribe():s}const se=[];function an(t,a){return{subscribe:ba(t,a).subscribe}}function ba(t,a=Wa){let e=null;const s=new Set;function l(u){if(ii(t,u)&&(t=u,e)){const d=!se.length;for(const v of s)v[1](),se.push(v,t);if(d){for(let v=0;v<se.length;v+=2)se[v][0](se[v+1]);se.length=0}}}function n(u){l(u(t))}function c(u,d=Wa){const v=[u,d];return s.add(v),s.size===1&&(e=a(l,n)||Wa),u(t),()=>{s.delete(v),s.size===0&&e&&(e(),e=null)}}return{set:l,update:n,subscribe:c}}function Ii(t,a,e){const s=!Array.isArray(t),l=s?[t]:t;if(!l.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const n=a.length<2;return an(e,(c,u)=>{let d=!1;const v=[];let b=0,f=Wa;const p=()=>{if(b)return;f();const y=a(s?v[0]:v,c,u);n?c(y):f=typeof y=="function"?y:Wa},h=l.map((y,L)=>Dr(y,A=>{v[L]=A,b&=~(1<<L),d&&p()},()=>{b|=1<<L}));return d=!0,p(),function(){ti(h),f(),d=!1}})}function en(t){let a;return Dr(t,e=>a=e)(),a}let xr=Symbol();function Lt(t,a,e){const s=e[a]??(e[a]={store:null,source:di(void 0),unsubscribe:Wa});if(s.store!==t&&!(xr in e))if(s.unsubscribe(),s.store=t??null,t==null)s.source.v=void 0,s.unsubscribe=Wa;else{var l=!0;s.unsubscribe=Dr(t,n=>{l?s.source.v=n:Y(s.source,n)}),l=!1}return t&&xr in e?en(t):r(s.source)}function rn(t,a){return t.set(a),a}function De(t,a){var e=t[a];e.store!==null&&rn(e.store,e.source.v)}function Ta(){const t={};function a(){bi(()=>{for(var e in t)t[e].unsubscribe();Xr(t,xr,{enumerable:!1,value:!0})})}return[t,a]}function Ca(t,a,e,s){var l;l=t[a];var n=s,c=!0,u=()=>(c&&(c=!1,n=s),n);l===void 0&&s!==void 0&&(l=u());var d;return d=()=>{var v=t[a];return v===void 0?u():(c=!0,v)},d}function on(t){xa===null&&uo(),gi(()=>{const a=er(t);if(typeof a=="function")return a})}const nn="5";var Qr;typeof window<"u"&&((Qr=window.__svelte??(window.__svelte={})).v??(Qr.v=new Set)).add(nn);const me=ba(typeof navigator<"u"?navigator.onLine:!0),$a=ba("home"),ka=ba(null),le=ba(!1),xt=ba(!1),qt=ba(""),ce=ba(""),Be=ba("");if(typeof window<"u"){let t,a;ce.subscribe(e=>{e&&(clearTimeout(t),t=setTimeout(()=>ce.set(""),5e3))}),Be.subscribe(e=>{e&&(clearTimeout(a),a=setTimeout(()=>Be.set(""),3e3))})}const Aa=ba([]),Na=ba([]),ve=ba([]),sn=ba([]),pe=ba([]),ln={costoOraManodopera:15,costoOraDisidratatore40:.9,costoOraDisidratatore100:1.9,marginePercentuale:30,aliquotaIVA:4,costiExtra:0},Vr=typeof localStorage<"u"?localStorage.getItem("parametriCosti"):null,xe=ba(Vr?JSON.parse(Vr):ln);typeof localStorage<"u"&&xe.subscribe(t=>{localStorage.setItem("parametriCosti",JSON.stringify(t))});const ze=Ii([Aa,Na,ve],([t,a,e])=>{const s=t.filter(D=>!D.completata),l=t.filter(D=>D.completata),n=t.filter(D=>!D.contoTerzi),c=n.reduce((D,M)=>D+(M.prodotti||[]).reduce((E,O)=>E+(parseFloat(O.kgAcquistati)||0),0),0),u=n.reduce((D,M)=>D+(M.prodotti||[]).reduce((E,O)=>E+(parseFloat(O.kgSecco)||0),0),0),d=a.filter(D=>!D.contoTerzi),v=d.filter(D=>!D.esaurito),b=d.filter(D=>D.esaurito),f=new Date,p=new Date(f);p.setDate(f.getDate()-f.getDay()+1),p.setHours(0,0,0,0);const h=e.filter(D=>new Date(D.data)>=p),y=f.getFullYear(),L=n.filter(D=>new Date(D.dataInizio).getFullYear()===y&&D.completata),A=L.reduce((D,M)=>D+(parseFloat(M.oreManooperaTotali)||0),0),N=L.reduce((D,M)=>D+(parseFloat(M.oreMacchinaTotali)||0),0);return{inCorso:s.length,completate:l.length,kgFreschi:c,kgSecchi:u,lottiTotali:d.length,lottiDisponibili:v.length,lottiEsauriti:b.length,pulizieSettimana:h.length,pulizieTotali:e.length,lavorazioniInCorso:s,lavorazioniCompletate:l,oreManodoperaAnno:A,oreMacchinaAnno:N}});Ii(Na,t=>t.reduce((a,e)=>{const s=e.productCategory||"altro";a[s]||(a[s]={});const l=e.productType||"Sconosciuto";return a[s][l]||(a[s][l]=[]),a[s][l].push(e),a},{}));function Ht(t){ce.set(t)}function ca(t){Be.set(t)}const Oi="https://disidratazione-backend.aziendamalbosca.workers.dev";class Le extends Error{constructor(a,e){super(a),this.status=e,this.name="ApiError"}}async function da(t,a={}){const e=`${Oi}${t}`;try{const s=await fetch(e,{...a,headers:{"Content-Type":"application/json",...a.headers}});if(!s.ok){const n=await s.text();throw new Le(n||`Errore HTTP ${s.status}`,s.status)}const l=await s.text();return l?JSON.parse(l):null}catch(s){throw s instanceof Le?s:navigator.onLine?new Le(s.message||"Errore di rete",0):new Le("Nessuna connessione internet",0)}}const gt={async getLavorazioni(){const t=await da("/lavorazioni");return Array.isArray(t)?t:[]},async salvaLavorazione(t){return da("/lavorazioni",{method:"POST",body:JSON.stringify(t)})},async eliminaLavorazione(t){return da(`/lavorazioni/${t}`,{method:"DELETE"})},async getLotti(){const t=await da("/lotti");return Array.isArray(t)?t:[]},async creaLotto(t){return da("/crea-lotto",{method:"POST",body:JSON.stringify(t)})},async aggiornaLotto(t,a){return da(`/lotti/${t}`,{method:"PUT",body:JSON.stringify(a)})},async eliminaLotto(t){return da(`/lotti/${t}`,{method:"DELETE"})},async toggleEsaurito(t,a){return da(`/lotti/${t}`,{method:"PUT",body:JSON.stringify({esaurito:a?1:0})})},async getPulizie(){const t=await da("/pulizie");return Array.isArray(t)?t:[]},async salvaPulizia(t){return da("/pulizie",{method:"POST",body:JSON.stringify(t)})},async aggiornaPulizia(t,a){return da("/pulizie",{method:"POST",body:JSON.stringify({...a,id:t})})},async eliminaPulizia(t){return da(`/pulizie/${t}`,{method:"DELETE"})},async getInventari(){const t=await da("/inventari");return Array.isArray(t)?t:[]},async salvaInventario(t){return da("/inventari",{method:"POST",body:JSON.stringify(t)})},async eliminaInventario(t){return da(`/inventari/${t}`,{method:"DELETE"})},async getReportPdf(){const t=await da("/report-pdf");return Array.isArray(t)?t:[]},getReportPdfUrl(t){return`${Oi}/report-pdf/${t}`},async eliminaReportPdf(t){return da(`/report-pdf/${t}`,{method:"DELETE"})},async inviaReportEmail(){return da("/invia-report",{method:"POST"})}};function Ba(t="ID"){return`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}var cn=x('<header class="navbar bg-base-100 shadow-lg sticky top-0 z-50"><div class="flex-1"><div class="flex items-center gap-2"><span class="text-3xl">ü•ï</span> <div><h1 class="text-xl font-bold text-primary">Disidratazione</h1> <p class="text-xs text-base-content/60">Tracciamento lavorazioni</p></div></div></div> <div class="flex-none"><div><div></div> </div></div></header>');function vn(t){const[a,e]=Ta(),s=()=>Lt(me,"$isOnline",a);var l=cn(),n=o(i(l),2),c=i(n),u=i(c),d=o(u);R(()=>{na(c,1,`badge ${s()?"badge-success":"badge-error"} gap-1`),na(u,1,`w-2 h-2 rounded-full ${s()?"bg-green-200":"bg-red-200"} animate-pulse`),g(d,` ${s()?"Online":"Offline"}`)}),_(t,l),e()}var dn=x('<span class="badge badge-warning badge-sm ml-auto"> </span>'),un=x('<span class="badge badge-ghost badge-sm ml-auto"> </span>'),pn=x('<button><span class="text-xl"> </span> <span class="font-medium"> </span> <!></button>'),fn=x('<aside class="fixed left-0 top-0 h-full w-64 bg-base-100 border-r border-base-200 flex flex-col z-50"><div class="p-6 border-b border-base-200"><div class="flex items-center gap-3"><span class="text-4xl">ü•ï</span> <div><h1 class="text-xl font-bold text-primary">Disidratazione</h1> <p class="text-xs text-base-content/60">Gestione lavorazioni</p></div></div></div> <nav class="flex-1 p-4 space-y-1 overflow-y-auto hide-scrollbar"><!> <div class="divider"></div> <button><span class="text-xl">‚öôÔ∏è</span> <span class="font-medium">Impostazioni</span></button></nav> <div class="p-4 border-t border-base-200"><div class="flex items-center justify-between text-sm"><div class="flex items-center gap-2"><div></div> <span class="text-base-content/60"> </span></div> <span class="text-base-content/40">v1.0</span></div></div></aside>');function _n(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt($a,"$currentTab",e),n=()=>Lt(ze,"$stats",e),c=()=>Lt(me,"$isOnline",e),u=[{id:"home",icon:"üìä",label:"Dashboard"},{id:"nuova",icon:"‚ú®",label:"Lavorazioni"},{id:"lotti",icon:"üì¶",label:"Lotti"},{id:"pulizie",icon:"üßπ",label:"Pulizie"},{id:"report",icon:"üìà",label:"Report"}];var d=fn(),v=o(i(d),2),b=i(v);Bt(b,17,()=>u,Yt,(D,M)=>{var E=pn();E.__click=()=>$a.set(r(M).id);var O=i(E),_t=i(O),rt=o(O,2),dt=i(rt),Wt=o(rt,2);{var Kt=it=>{var va=dn(),ra=i(va);R(()=>g(ra,n().inCorso)),_(it,va)},Qt=(it,va)=>{{var ra=C=>{var w=un(),k=i(w);R(()=>g(k,n().lottiDisponibili)),_(C,w)};T(it,C=>{r(M).id==="lotti"&&C(ra)},va)}};T(Wt,it=>{r(M).id==="nuova"&&n().inCorso>0?it(Kt):it(Qt,!1)})}R(()=>{na(E,1,`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
               ${l()===r(M).id?"bg-primary text-primary-content shadow-md":"hover:bg-base-200 text-base-content"}`),g(_t,r(M).icon),g(dt,r(M).label)}),_(D,E)});var f=o(b,4);f.__click=()=>$a.set("impostazioni");var p=o(v,2),h=i(p),y=i(h),L=i(y),A=o(L,2),N=i(A);R(()=>{na(f,1,`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
             ${l()==="impostazioni"?"bg-primary text-primary-content shadow-md":"hover:bg-base-200 text-base-content"}`),na(L,1,`w-2 h-2 rounded-full ${c()?"bg-success":"bg-error"} animate-pulse`),g(N,c()?"Online":"Offline")}),_(t,d),Sa(),s()}Ma(["click"]);var bn=x('<span class="absolute -top-1 -right-2 badge badge-warning badge-xs"> </span>'),gn=x('<button><span class="text-xl relative"> <!></span> <span class="btm-nav-label text-xs font-medium"> </span></button>'),mn=x('<nav class="btm-nav btm-nav-lg bg-base-100 shadow-[0_-4px_20px_rgba(0,0,0,0.1)] pb-safe z-50"></nav>');function xn(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt($a,"$currentTab",e),n=()=>Lt(ze,"$stats",e),c=[{id:"home",icon:"üìä",label:"Home"},{id:"nuova",icon:"‚ú®",label:"Nuova"},{id:"lotti",icon:"üì¶",label:"Lotti"},{id:"pulizie",icon:"üßπ",label:"Pulizie"},{id:"report",icon:"üìà",label:"Report"}];var u=mn();Bt(u,21,()=>c,Yt,(d,v)=>{var b=gn();b.__click=()=>$a.set(r(v).id);var f=i(b),p=i(f),h=o(p);{var y=N=>{var D=bn(),M=i(D);R(()=>g(M,n().inCorso)),_(N,D)};T(h,N=>{r(v).id==="nuova"&&n().inCorso>0&&N(y)})}var L=o(f,2),A=i(L);R(()=>{na(b,1,`relative transition-all duration-200 
             ${l()===r(v).id?"active bg-primary/10 text-primary border-t-[3px] border-primary":"text-base-content/60 hover:text-primary"}`),g(p,`${r(v).icon??""} `),g(A,r(v).label)}),_(d,b)}),_(t,u),Sa(),s()}Ma(["click"]);var hn=x('<div class="alert alert-success shadow-lg animate-slide-up"><span> </span></div>'),yn=x('<div class="alert alert-error shadow-lg animate-slide-up"><span> </span> <button class="btn btn-ghost btn-xs">‚úï</button></div>'),wn=x('<div class="toast toast-top toast-end z-[100]"><!> <!></div>');function kn(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(Be,"$successMessage",e),n=()=>Lt(ce,"$errorMessage",e);var c=wn(),u=i(c);{var d=f=>{var p=hn(),h=i(p),y=i(h);R(()=>g(y,`‚úÖ ${l()??""}`)),_(f,p)};T(u,f=>{l()&&f(d)})}var v=o(u,2);{var b=f=>{var p=yn(),h=i(p),y=i(h),L=o(h,2);L.__click=()=>ce.set(""),R(()=>g(y,`‚ùå ${n()??""}`)),_(f,p)};T(v,f=>{n()&&f(b)})}_(t,c),Sa(),s()}Ma(["click"]);var zn=x('<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[200]"><div class="bg-base-100 rounded-2xl p-6 shadow-2xl flex flex-col items-center gap-4"><span class="loading loading-spinner loading-lg text-primary"></span> <p class="text-base-content font-medium"> </p></div></div>');function $n(t){const[a,e]=Ta(),s=()=>Lt(xt,"$isLoading",a),l=()=>Lt(qt,"$loadingMessage",a);var n=Ei(),c=Qa(n);{var u=d=>{var v=zn(),b=i(v),f=o(i(b),2),p=i(f);R(()=>g(p,l())),_(d,v)};T(c,d=>{s()&&l()&&d(u)})}_(t,n),e()}function Mi(t,a){if(!t||!a)return 0;const[e,s]=t.split(":").map(Number),[l,n]=a.split(":").map(Number);let c=l-e+(n-s)/60;return c<0&&(c+=24),c}function Pn(t){return Array.isArray(t)?t.reduce((a,e)=>{const s=Mi(e.oraInizioLavoro,e.oraFineLavoro),l=parseInt(e.numeroPersone)||1;return a+s*l},0):0}function Hr(t,a="40"){if(!Array.isArray(t)||t.length===0)return 0;const e=a==="40"?"oraAccensione40":"oraAccensione100",s=a==="40"?"oraSpegnimento40":"oraSpegnimento100";let l=0,n=!1;const c=[...t].sort((u,d)=>new Date(u.data)-new Date(d.data));for(let u=0;u<c.length;u++){const d=c[u],v=d[e],b=d[s];if(n)if(b){const[f,p]=b.split(":").map(Number);l+=f+p/60,n=!1}else v||(l+=24);if(v)if(b)l+=Mi(v,b),n=!1;else{const[f,p]=v.split(":").map(Number);l+=24-f-p/60,n=!0}}return l}function Yr(t,a){const{costoOraManodopera:e=15,costoOraDisidratatore40:s=.9,costoOraDisidratatore100:l=1.9,marginePercentuale:n=30,aliquotaIVA:c=4,costiExtra:u=0}=a,d=Pn(t.attivita),v=Hr(t.attivita,"40"),b=Hr(t.attivita,"100"),f=d*e,p=v*s,h=b*l,y=f+p+h+u,L=t.prodotti||[],A=L.reduce((rt,dt)=>rt+(parseFloat(dt.kgSecco)||0),0),N=L.reduce((rt,dt)=>{const Wt=parseFloat(dt.kgAcquistati)||0,Kt=parseFloat(dt.costoKg)||0;return rt+Wt*Kt},0),D=L.reduce((rt,dt)=>rt+(parseFloat(dt.kgAcquistati)||0),0),M=y+N,E=A>0?M/A:0,O=E*(1+n/100),_t=O*(1+c/100);return{oreManodopera:d,oreDisidratatore40:v,oreDisidratatore100:b,oreMacchinaTotali:v+b,costoManodopera:f,costoEnergia40:p,costoEnergia100:h,costoProduzione:y,costoMateriaPrimaTotale:N,kgFreschiTotali:D,kgSecchiTotali:A,costoTotale:M,costoProdKg:E,prezzoConMargine:O,prezzoConIva:_t}}function Sn(t,a,e,s){const{marginePercentuale:l=30,aliquotaIVA:n=4}=s,c=parseFloat(t.kgSecco)||0,u=parseFloat(t.kgAcquistati)||0,d=parseFloat(t.costoKg)||0,v=e>0?c/e:0,b=a*v,f=u*d,p=b+f,h=p*(1+l/100),y=h*(1+n/100),L=c>0?p/c:0,A=c>0?h/c:0,N=c>0?y/c:0;return{percentuale:v*100,quotaCostoProduzione:b,costoMateriaPrima:f,costoTotaleProdotto:p,prezzoConMargine:h,prezzoConIva:y,costoPerKg:L,prezzoPerKg:A,prezzoPerKgIva:N}}function qa(t){return t?new Date(t).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function Fi(t){return t?new Date(t).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Ya(t,a=2){return t==null||isNaN(t)?"‚Ç¨ 0,00":`‚Ç¨ ${t.toFixed(a).replace(".",",")}`}function ta(t,a=2){return t==null||isNaN(t)?"0":t.toFixed(a).replace(".",",")}function Ja(t){if(!t)return"0h";const a=Math.floor(t),e=Math.round((t-a)*60);return e>0?`${a}h ${e}m`:`${a}h`}const hr={verdura:{emoji:"ü•¨",nome:"Verdura",colore:"success"},frutta:{emoji:"üçé",nome:"Frutta",colore:"error"},frutta_secca:{emoji:"ü•ú",nome:"Frutta Secca",colore:"warning"},riso:{emoji:"üçö",nome:"Riso",colore:"info"},vasetti:{emoji:"ü´ô",nome:"Vasetti",colore:"secondary"}},Br=["proprio","acquistato"];function Tn(t){if(!t)return"";const a=new Date(t);return a.setMonth(a.getMonth()+30),a.toISOString().split("T")[0]}function An(t){if(!t)return"-";const a=new Date(t);return`${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][a.getMonth()]} ${a.getFullYear()}`}function Gr(t){if(!t)return!1;const a=new Date,e=new Date(t),s=(e.getFullYear()-a.getFullYear())*12+(e.getMonth()-a.getMonth());return s<=3&&s>=0}function Jr(t){return t?new Date(t)<new Date:!1}var En=(t,a,e)=>{var s;return a()&&((s=e())==null?void 0:s())},Dn=x("<span> </span>"),Ln=x('<div class="text-xl opacity-30">‚ñ∂</div>'),Cn=x('<button><div class="card-body p-4"><div class="flex items-start justify-between"><div><div class="flex items-center gap-2"><h3 class="text-2xl font-bold"> </h3> <!></div> <p class="text-xs opacity-70 mt-1"> </p></div> <!></div></div></button>');function Ce(t,a){Pa(a,!0);let e=Ca(a,"icon",3,""),s=Ca(a,"color",3,"primary"),l=Ca(a,"clickable",3,!1),n=Ca(a,"badge",3,null),c=Ca(a,"onclick",3,null);const u={primary:"from-green-50 to-emerald-50 text-green-600 border-green-100",secondary:"from-amber-50 to-yellow-50 text-amber-600 border-amber-100",accent:"from-cyan-50 to-teal-50 text-cyan-600 border-cyan-100",info:"from-blue-50 to-indigo-50 text-blue-600 border-blue-100",success:"from-emerald-50 to-green-50 text-emerald-600 border-emerald-100",warning:"from-amber-50 to-orange-50 text-amber-600 border-amber-100",error:"from-red-50 to-rose-50 text-red-600 border-red-100"};var d=Cn();d.__click=[En,l,c];var v=i(d),b=i(v),f=i(b),p=i(f),h=i(p),y=i(h),L=o(h,2);{var A=O=>{var _t=Dn(),rt=i(_t);R(()=>{na(_t,1,`badge badge-${(n().color||"primary")??""} badge-sm`),g(rt,n().text)}),_(O,_t)};T(L,O=>{n()&&O(A)})}var N=o(p,2),D=i(N),M=o(f,2);{var E=O=>{var _t=Ln();_(O,_t)};T(M,O=>{l()&&O(E)})}R(()=>{na(d,1,`card bg-gradient-to-br ${u[s()]??""} border shadow-sm hover:shadow-md 
         transition-all duration-200 text-left w-full
         ${l()?"cursor-pointer hover:scale-[1.02] active:scale-[0.98]":""}`),d.disabled=!l(),g(y,a.value),g(D,`${e()??""} ${a.label??""}`)}),_(t,d),Sa()}Ma(["click"]);var In=()=>$a.set("pulizie"),On=(t,a,e)=>a(r(e)),Mn=x('<button class="w-full flex justify-between items-center p-3 bg-warning/10 hover:bg-warning/20 rounded-xl transition-colors text-left"><div><p class="font-medium"> </p> <p class="text-xs text-base-content/50"> </p></div> <span class="text-warning text-xl">‚ñ∂</span></button>'),Fn=x('<div class="card bg-base-100 shadow-md"><div class="card-body p-4"><h3 class="font-semibold text-sm flex items-center gap-2 mb-3"><span class="badge badge-warning badge-sm animate-pulse">Live</span> Lavorazioni in corso</h3> <div class="space-y-2"></div></div></div>'),Nn=x('<span title="Piano lavoro">üßº</span>'),Rn=x('<span title="Spazzatura pavimento">üßπ</span>'),qn=x('<span title="Disidratatore">‚ö°</span>'),Kn=x('<div class="flex justify-between items-center p-2 bg-base-200/50 rounded-lg text-sm"><div class="flex items-center gap-2"><span class="font-medium"> </span></div> <div class="flex items-center gap-2"><!> <!> <!></div></div>'),jn=x('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><h3 class="font-semibold text-sm text-base-content/70 mb-2">üßπ Ultime pulizie</h3> <div class="space-y-2"></div></div></div>'),Un=(t,a)=>Y(a,!r(a)),Vn=x('<span class="badge badge-outline badge-warning badge-sm">üë§</span>'),Hn=(t,a,e)=>a(r(e)),Yn=x('<div class="flex justify-between items-center p-3 bg-base-200/50 rounded-lg"><div><p class="font-medium"> </p> <p class="text-xs text-base-content/50"> </p></div> <div class="flex items-center gap-2"><!> <span> </span> <button class="btn btn-ghost btn-xs">üëÅÔ∏è</button></div></div>'),Bn=x('<p class="text-center text-base-content/50 py-4">Nessuna lavorazione</p>'),Gn=x('<div class="card bg-base-100 shadow-md animate-slide-up"><div class="card-body p-4"><div class="flex justify-between items-center mb-3"><h3 class="font-bold">üìã Storico Lavorazioni</h3> <select class="select select-bordered select-sm"><option>Tutte</option><option>In corso</option><option>Completate</option></select></div> <div class="space-y-2 max-h-96 overflow-y-auto"></div></div></div>'),Jn=x('<div class="space-y-6"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-primary rounded-full"></div> <h2 class="text-lg font-bold">Dashboard</h2></div> <div class="grid grid-cols-2 lg:grid-cols-4 gap-3"><!> <!> <!> <!></div> <div class="stats stats-vertical lg:stats-horizontal shadow w-full bg-base-100"><div class="stat"><div class="stat-figure text-primary"><span class="text-3xl">üë∑</span></div> <div class="stat-title"> </div> <div class="stat-value text-primary"> </div></div> <div class="stat"><div class="stat-figure text-secondary"><span class="text-3xl">‚ö°</span></div> <div class="stat-title"> </div> <div class="stat-value text-secondary"> </div></div></div> <div class="card bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 shadow-sm"><div class="card-body p-4"><div class="flex justify-between items-center"><div><h3 class="text-3xl font-bold text-amber-600"> </h3> <p class="text-sm text-amber-700/70">üßπ Pulizie questa settimana</p></div> <button class="btn btn-warning btn-sm">Registra</button></div></div></div> <!> <!> <button class="btn btn-ghost btn-block gap-2"> <span class="text-xs"> </span></button> <!></div>');function Wn(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(ze,"$stats",e),n=()=>Lt(Aa,"$lavorazioni",e),c=()=>Lt(ve,"$pulizie",e);Ca(a,"onreload",3,null);let u=ht(!1),d=ht("tutte");function v(){l().lavorazioniInCorso.length===1?(ka.set(l().lavorazioniInCorso[0]),$a.set("nuova")):l().lavorazioniInCorso.length>1&&$a.set("nuova")}function b(B){ka.set(B),$a.set("nuova")}let f=Rt(()=>n().filter(B=>r(d)==="inCorso"?!B.completata:r(d)==="completate"?B.completata:!0).sort((B,yt)=>new Date(yt.dataInizio)-new Date(B.dataInizio)));var p=Jn(),h=o(i(p),2),y=i(h);const L=Rt(()=>l().inCorso>0),A=Rt(()=>l().inCorso>0?{text:"Live",color:"warning"}:null);Ce(y,{get value(){return l().inCorso},label:"In corso",icon:"üîÑ",color:"warning",get clickable(){return r(L)},get badge(){return r(A)},onclick:v});var N=o(y,2);Ce(N,{get value(){return l().completate},label:"Completate",icon:"‚úÖ",color:"success"});var D=o(N,2);const M=Rt(()=>l().kgFreschi.toFixed(1));Ce(D,{get value(){return`${r(M)??""} kg`},label:"Kg freschi totali",icon:"ü•¨",color:"info"});var E=o(D,2);Ce(E,{get value(){return l().lottiDisponibili},label:"Lotti disponibili",icon:"üì¶",color:"accent",clickable:!0,onclick:()=>$a.set("lotti")});var O=o(h,2),_t=i(O),rt=o(i(_t),2),dt=i(rt),Wt=o(rt,2),Kt=i(Wt),Qt=o(_t,2),it=o(i(Qt),2),va=i(it),ra=o(it,2),C=i(ra),w=o(O,2),k=i(w),I=i(k),J=i(I),st=i(J),q=i(st),tt=o(J,2);tt.__click=[In];var at=o(w,2);{var Ct=B=>{var yt=Fn(),wt=i(yt),K=o(i(wt),2);Bt(K,5,()=>l().lavorazioniInCorso,Yt,(W,lt)=>{var Tt=Mn();const jt=Rt(()=>{var Vt;return((Vt=r(lt).prodotti)==null?void 0:Vt.map(S=>S.prodotto).join(", "))||"Lavorazione"});Tt.__click=[On,b,lt];var ia=i(Tt),Ut=i(ia),et=i(Ut),Mt=o(Ut,2),ea=i(Mt);R(Vt=>{var S;g(et,r(jt)),g(ea,`üìÖ ${Vt??""} 
                  ‚Ä¢ ${(((S=r(lt).attivita)==null?void 0:S.length)||0)??""} attivit√†`)},[()=>qa(r(lt).dataInizio)]),_(W,Tt)}),_(B,yt)};T(at,B=>{l().lavorazioniInCorso.length>0&&B(Ct)})}var St=o(at,2);{var Xt=B=>{var yt=jn(),wt=i(yt),K=o(i(wt),2);Bt(K,5,()=>c().slice(0,3),Yt,(W,lt)=>{var Tt=Kn(),jt=i(Tt),ia=i(jt),Ut=i(ia),et=o(jt,2),Mt=i(et);{var ea=U=>{var ft=Nn();_(U,ft)};T(Mt,U=>{r(lt).pianoLavoro&&U(ea)})}var Vt=o(Mt,2);{var S=U=>{var ft=Rn();_(U,ft)};T(Vt,U=>{r(lt).spazzaturaPavimento&&U(S)})}var F=o(Vt,2);{var V=U=>{var ft=qn();_(U,ft)};T(F,U=>{r(lt).disidratatore&&U(V)})}R(U=>g(Ut,U),[()=>qa(r(lt).data)]),_(W,Tt)}),_(B,yt)};T(St,B=>{c().length>0&&B(Xt)})}var aa=o(St,2);aa.__click=[Un,u];var mt=i(aa),nt=o(mt),sa=i(nt),Gt=o(aa,2);{var Jt=B=>{var yt=Gn(),wt=i(yt),K=i(wt),W=o(i(K),2),lt=i(W);lt.value=lt.__value="tutte";var Tt=o(lt);Tt.value=Tt.__value="inCorso";var jt=o(Tt);jt.value=jt.__value="completate";var ia=o(K,2);Bt(ia,21,()=>r(f),Yt,(Ut,et)=>{var Mt=Yn();const ea=Rt(()=>{var $;return(($=r(et).prodotti)==null?void 0:$.map(G=>G.prodotto).join(", "))||"Lavorazione"});var Vt=i(Mt),S=i(Vt),F=i(S),V=o(S,2),U=i(V),ft=o(Vt,2),m=i(ft);{var z=$=>{var G=Vn();_($,G)};T(m,$=>{r(et).contoTerzi&&$(z)})}var Q=o(m,2),H=i(Q),P=o(Q,2);P.__click=[Hn,b,et],R($=>{g(F,r(ea)),g(U,`üìÖ ${$??""}`),na(Q,1,`badge ${r(et).completata?"badge-success":"badge-warning"} badge-sm`),g(H,r(et).completata?"‚úÖ":"‚è≥")},[()=>qa(r(et).dataInizio)]),_(Ut,Mt)},Ut=>{var et=Bn();_(Ut,et)}),be(W,()=>r(d),Ut=>Y(d,Ut)),_(B,yt)};T(Gt,B=>{r(u)&&B(Jt)})}R((B,yt,wt,K)=>{g(dt,`Ore Manodopera ${B??""}`),g(Kt,yt),g(va,`Ore Macchina ${wt??""}`),g(C,K),g(q,l().pulizieSettimana),g(mt,`üìú ${r(u)?"Nascondi":"Vedi"} Storico Lavorazioni `),g(sa,`(${n().length??""})`)},[()=>new Date().getFullYear(),()=>Ja(l().oreManodoperaAnno),()=>new Date().getFullYear(),()=>Ja(l().oreMacchinaAnno)]),_(t,p),Sa(),s()}Ma(["click"]);function Qn(t,a){r(a).prodotti=[...r(a).prodotti,{id:Ba("PROD"),prodotto:"",fornitore:"proprio",kgAcquistati:"",costoKg:""}]}var Xn=x('<span class="badge badge-outline badge-warning">üë§ Conto Terzi</span>'),Zn=(t,a)=>Y(a,!r(a)),ts=x('<button class="btn btn-ghost btn-xs ml-2"> </button>'),as=x("<option> </option>"),es=x('<div class="grid grid-cols-3 gap-2 p-2 bg-base-200/50 rounded-lg"><input type="text" class="input input-sm input-bordered col-span-3" placeholder="Prodotto"/> <input type="number" step="0.1" class="input input-sm input-bordered" placeholder="Kg freschi"/> <input type="number" step="0.01" class="input input-sm input-bordered" placeholder="‚Ç¨/kg"/> <select class="select select-sm select-bordered"></select></div>'),rs=x('<div class="space-y-2"><!> <button class="btn btn-primary btn-sm btn-block">üíæ Salva Modifiche</button></div>'),is=x('<span class="ml-2"> </span>'),os=x('<span class="ml-2 text-success"> </span>'),ns=x('<div class="flex justify-between items-center p-2 bg-base-200/50 rounded-lg text-sm"><span class="font-medium"> </span> <div class="text-right text-base-content/60"><span> </span> <!> <!></div></div>'),ss=x('<div class="space-y-2"></div>'),ls=(t,a,e)=>a(r(e).id),cs=x('<button class="btn btn-ghost btn-xs text-error">üóëÔ∏è</button>'),vs=x('<div class="p-2 bg-base-200/50 rounded-lg text-sm"><div class="flex justify-between"><span class="font-medium"> </span> <div class="flex items-center gap-2"><span> </span> <!></div></div> <div class="text-xs text-base-content/50 mt-1"><!> <!></div></div>'),ds=x('<div class="space-y-2 max-h-48 overflow-y-auto"></div>'),us=x('<p class="text-center text-base-content/50 py-2">Nessuna attivit√† registrata</p>'),ps=x('<div class="divider text-sm">üí∞ Riepilogo Costi</div> <div class="stats stats-vertical shadow w-full text-sm"><div class="stat p-3"><div class="stat-title text-xs"> </div> <div class="stat-value text-lg"> </div></div> <div class="stat p-3"><div class="stat-title text-xs"> </div> <div class="stat-value text-lg"> </div></div> <div class="stat p-3"><div class="stat-title text-xs"> </div> <div class="stat-value text-lg"> </div></div> <div class="stat p-3 bg-primary/10"><div class="stat-title text-xs">üíµ Totale</div> <div class="stat-value text-lg text-primary"> </div></div></div>',1),fs=x('<div class="divider text-sm">‚ûï Aggiungi Attivit√†</div> <div class="space-y-3"><div class="grid grid-cols-2 gap-3"><div class="form-control"><label class="label py-1"><span class="label-text text-xs">üìÖ Data</span></label> <input type="date" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">üë• Persone</span></label> <input type="number" min="1" class="input input-bordered input-sm"/></div></div> <div class="grid grid-cols-2 gap-3"><div class="form-control"><label class="label py-1"><span class="label-text text-xs">üïê Inizio lavoro</span></label> <input type="time" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">üïê Fine lavoro</span></label> <input type="time" class="input input-bordered input-sm"/></div></div> <div class="collapse collapse-arrow bg-base-200/50 rounded-lg"><input type="checkbox"/> <div class="collapse-title text-sm font-medium py-2">‚ö° Disidratatori (opzionale)</div> <div class="collapse-content"><div class="grid grid-cols-2 gap-3"><div class="form-control"><label class="label py-1"><span class="label-text text-xs">Acc. 40</span></label> <input type="time" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Speg. 40</span></label> <input type="time" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Acc. 100</span></label> <input type="time" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Speg. 100</span></label> <input type="time" class="input input-bordered input-sm"/></div></div></div></div> <button class="btn btn-secondary btn-block">‚ûï Aggiungi Attivit√†</button></div>',1),_s=x('<button class="btn btn-warning">üîÑ Riapri</button>'),bs=x('<button class="btn btn-success"><!></button>'),gs=x('<div class="card bg-base-100 shadow-lg"><div class="card-body"><div class="flex justify-between items-start"><div><h3 class="card-title text-warning"> </h3> <p class="text-sm text-base-content/60 mt-1"> </p></div> <div class="flex flex-col gap-1 items-end"><span> </span> <!></div></div> <div class="divider text-sm">üì¶ Prodotti <!></div> <!> <div class="divider text-sm"> </div> <!> <!> <!> <div class="card-actions justify-between mt-4"><div class="flex gap-2"><button class="btn btn-ghost">‚Üê Indietro</button> <button class="btn btn-error btn-outline btn-sm">üóëÔ∏è</button></div> <!></div></div></div>'),ms=x("<option> </option>"),xs=x('<button class="btn btn-xs btn-ghost text-error mt-2">üóëÔ∏è Rimuovi</button>'),hs=x('<div class="card bg-base-200/50 p-3 mb-2"><div class="grid grid-cols-2 gap-3"><div class="form-control col-span-2"><label class="label py-1"><span class="label-text text-xs">Prodotto *</span></label> <input type="text" placeholder="Es: Cavolo riccio" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Fornitore</span></label> <select class="select select-bordered select-sm"></select></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Kg freschi</span></label> <input type="number" step="0.1" placeholder="0.0" class="input input-bordered input-sm"/></div> <div class="form-control col-span-2"><label class="label py-1"><span class="label-text text-xs">üí∞ ‚Ç¨/kg Materia Prima</span></label> <input type="number" step="0.01" placeholder="0.00" class="input input-bordered input-sm"/></div></div> <!></div>'),ys=x('<div class="card bg-base-100 shadow-lg"><div class="card-body"><h3 class="card-title text-secondary">‚ú® Avvia nuova lavorazione</h3> <div class="form-control mt-4"><label class="label"><span class="label-text font-medium">üìÖ Data inizio</span></label> <input type="date" class="input input-bordered"/></div> <div class="form-control mt-2"><label class="label cursor-pointer justify-start gap-3"><input type="checkbox" class="checkbox checkbox-warning"/> <span class="label-text">üë§ Conto Terzi</span> <span class="text-xs text-base-content/50">(non incluso nelle statistiche)</span></label></div> <div class="divider">üì¶ Prodotti</div> <!> <button class="btn btn-ghost btn-sm">‚ûï Aggiungi prodotto</button> <div class="card-actions justify-end mt-4"><button class="btn btn-primary btn-lg">üöÄ Avvia Lavorazione</button></div></div></div>'),ws=x("<option> </option>"),ks=x('<div class="card bg-base-200 p-4"><h4 class="font-bold"> </h4> <p class="text-xs text-base-content/60 mb-3"> </p> <div class="grid grid-cols-2 gap-3"><div class="form-control"><label class="label py-1"><span class="label-text text-xs">Kg secco *</span></label> <input type="number" step="0.01" placeholder="0.00" class="input input-bordered input-sm"/></div> <div class="form-control"><label class="label py-1"><span class="label-text text-xs">Categoria</span></label> <select class="select select-bordered select-sm"></select></div></div></div>'),zs=x('<div class="modal modal-open"><div class="modal-box max-w-lg"><h3 class="font-bold text-lg"><!></h3> <p class="py-2 text-sm text-base-content/70"><!></p> <div class="space-y-4 mt-4"></div> <div class="modal-action"><button class="btn btn-ghost">Annulla</button> <button class="btn btn-success"><!></button></div></div> <div class="modal-backdrop"></div></div>'),$s=x('<div class="space-y-6"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-secondary rounded-full"></div> <h2 class="text-lg font-bold"> </h2></div> <!></div> <!>',1);function Ps(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(le,"$showCompletamento",e),n=()=>Lt(ka,"$currentLavorazione",e),c=()=>Lt(xe,"$parametriCosti",e),u=()=>Lt(Na,"$lotti",e);Ca(a,"onreload",3,null);let d=ht(fa({dataInizio:new Date().toISOString().split("T")[0],prodotti:[{id:Ba("PROD"),prodotto:"",fornitore:"proprio",kgAcquistati:"",costoKg:""}],contoTerzi:!1})),v=ht(fa({data:new Date().toISOString().split("T")[0],oraInizioLavoro:"",oraFineLavoro:"",numeroPersone:1,oraAccensione40:"",oraSpegnimento40:"",oraAccensione100:"",oraSpegnimento100:""})),b=ht(fa([])),f=ht(!1);gi(()=>{l()&&n()&&Y(b,(n().prodotti||[]).map(w=>({id:w.id,prodotto:w.prodotto,kgAcquistati:w.kgAcquistati,kgSecco:w.kgSecco||"",categoria:w.categoria||"verdura",costoKg:w.costoKg||0})),!0)});function p(w){r(d).prodotti=r(d).prodotti.filter((k,I)=>I!==w)}async function h(){const w=r(d).prodotti.filter(k=>k.prodotto.trim());if(w.length===0){Ht("Inserisci almeno un prodotto");return}xt.set(!0),qt.set("Creazione lavorazione...");try{const k={id:Ba("LAV"),dataInizio:r(d).dataInizio,prodotti:w.map(I=>({...I,id:I.id||Ba("PROD"),kgAcquistati:parseFloat(I.kgAcquistati)||0,costoKg:parseFloat(I.costoKg)||0})),attivita:[],completata:!1,contoTerzi:r(d).contoTerzi||!1};await gt.salvaLavorazione(k),Aa.update(I=>[...I,k]),ka.set(k),Y(d,{dataInizio:new Date().toISOString().split("T")[0],prodotti:[{id:Ba("PROD"),prodotto:"",fornitore:"proprio",kgAcquistati:"",costoKg:""}],contoTerzi:!1},!0),ca("Lavorazione avviata!")}catch(k){Ht(k.message)}finally{xt.set(!1),qt.set("")}}async function y(){xt.set(!0),qt.set("Salvataggio...");try{const w={...n(),prodotti:n().prodotti.map(k=>({...k,kgAcquistati:parseFloat(k.kgAcquistati)||0,costoKg:parseFloat(k.costoKg)||0,kgSecco:k.kgSecco?parseFloat(k.kgSecco):null}))};await gt.salvaLavorazione(w),ka.set(w),Aa.update(k=>k.map(I=>I.id===w.id?w:I)),Y(f,!1),ca("Prodotti aggiornati!")}catch(w){Ht(w.message)}finally{xt.set(!1),qt.set("")}}async function L(){const w=r(v).oraInizioLavoro&&r(v).oraFineLavoro,k=r(v).oraAccensione40||r(v).oraSpegnimento40||r(v).oraAccensione100||r(v).oraSpegnimento100;if(!w&&!k){Ht("Inserisci almeno orari lavoro o dati disidratatore");return}if(r(v).oraInizioLavoro&&!r(v).oraFineLavoro||!r(v).oraInizioLavoro&&r(v).oraFineLavoro){Ht("Inserisci sia inizio che fine lavoro");return}xt.set(!0),qt.set("Salvataggio attivit√†...");try{const I={id:Ba("ATT"),...r(v)},J={...n(),attivita:[...n().attivita||[],I]};await gt.salvaLavorazione(J),ka.set(J),Aa.update(st=>st.map(q=>q.id===J.id?J:q)),Y(v,{data:new Date().toISOString().split("T")[0],oraInizioLavoro:"",oraFineLavoro:"",numeroPersone:1,oraAccensione40:"",oraSpegnimento40:"",oraAccensione100:"",oraSpegnimento100:""},!0),ca("Attivit√† aggiunta!")}catch(I){Ht(I.message)}finally{xt.set(!1),qt.set("")}}async function A(w){if(confirm("Eliminare questa attivit√†?")){xt.set(!0);try{const k={...n(),attivita:n().attivita.filter(I=>I.id!==w)};await gt.salvaLavorazione(k),ka.set(k),Aa.update(I=>I.map(J=>J.id===k.id?k:J)),ca("Attivit√† eliminata")}catch(k){Ht(k.message)}finally{xt.set(!1)}}}async function N(){if(r(b).filter(k=>!k.kgSecco||parseFloat(k.kgSecco)<=0).length>0){Ht("Inserisci i kg secchi per tutti i prodotti");return}xt.set(!0),qt.set("Completamento lavorazione...");try{const k=Yr(n(),c()),I=r(b).reduce((q,tt)=>q+parseFloat(tt.kgSecco),0);for(const q of r(b)){const tt=Sn({...q,kgSecco:parseFloat(q.kgSecco),kgAcquistati:parseFloat(q.kgAcquistati)},k.costoProduzione,I,c()),at={prodotto:q.prodotto,categoria:q.categoria,dataInizio:n().dataInizio,kgFreschi:parseFloat(q.kgAcquistati)||0,kgSecco:parseFloat(q.kgSecco),fornitore:q.fornitore||"proprio",idLavorazione:n().id,tipo:"produzione",contoTerzi:n().contoTerzi||!1,dataScadenza:Tn(n().dataInizio),oreManodopera:k.oreManodopera,oreDisidratatore40:k.oreDisidratatore40,oreDisidratatore100:k.oreDisidratatore100,costoOraManodopera:c().costoOraManodopera,costoOraDisidratatore40:c().costoOraDisidratatore40,costoOraDisidratatore100:c().costoOraDisidratatore100,marginePercentuale:c().marginePercentuale,aliquotaIVA:c().aliquotaIVA,costiExtra:c().costiExtra,costoManodopera:k.costoManodopera,costoEnergia:k.costoEnergia40+k.costoEnergia100,costoKgMateriaPrima:parseFloat(q.costoKg)||0,costoMateriaPrima:tt.costoMateriaPrima,quotaCostoProduzione:tt.quotaCostoProduzione,costoTotaleProdotto:tt.costoTotaleProdotto,prezzoConMargine:tt.prezzoConMargine,prezzoConIVA:tt.prezzoConIva,costoAlKg:tt.costoPerKg,prezzoAlKg:tt.prezzoPerKg,prezzoAlKgIVA:tt.prezzoPerKgIva};await gt.creaLotto(at)}const J={...n(),completata:!0,oreManooperaTotali:k.oreManodopera,oreMacchinaTotali:k.oreMacchinaTotali,prodotti:n().prodotti.map(q=>{const tt=r(b).find(at=>at.id===q.id);return{...q,kgSecco:tt?parseFloat(tt.kgSecco):q.kgSecco,categoria:tt?tt.categoria:q.categoria}})};await gt.salvaLavorazione(J),ka.set(J),Aa.update(q=>q.map(tt=>tt.id===J.id?J:tt)),le.set(!1);const st=await gt.getLotti();Na.set(st),ca("Lavorazione completata e lotti creati!"),ka.set(null),$a.set("home")}catch(k){Ht(k.message)}finally{xt.set(!1),qt.set("")}}async function D(){if(confirm("Riaprire la lavorazione? I lotti associati verranno eliminati, ma i dati (kg secchi) saranno mantenuti.")){xt.set(!0),qt.set("Riapertura lavorazione...");try{const w=u().filter(I=>I.idLavorazione===n().id);for(const I of w)await gt.eliminaLotto(I.id);const k={...n(),completata:!1,oreManooperaTotali:null,oreMacchinaTotali:null};await gt.salvaLavorazione(k),ka.set(k),Aa.update(I=>I.map(J=>J.id===k.id?k:J)),Na.update(I=>I.filter(J=>J.idLavorazione!==n().id)),ca("Lavorazione riaperta")}catch(w){Ht(w.message)}finally{xt.set(!1),qt.set("")}}}async function M(){if(confirm("Eliminare questa lavorazione? Tutti i dati verranno persi.")){xt.set(!0);try{await gt.eliminaLavorazione(n().id),Aa.update(w=>w.filter(k=>k.id!==n().id)),Na.update(w=>w.filter(k=>k.idLavorazione!==n().id)),ka.set(null),ca("Lavorazione eliminata")}catch(w){Ht(w.message)}finally{xt.set(!1)}}}let E=Rt(()=>n()?Yr(n(),c()):null);function O(){ka.set(null),le.set(!1),Y(f,!1)}var _t=$s(),rt=Qa(_t),dt=i(rt),Wt=o(i(dt),2),Kt=i(Wt),Qt=o(dt,2);{var it=w=>{var k=gs(),I=i(k),J=i(I),st=i(J),q=i(st),tt=i(q),at=o(q,2),Ct=i(at),St=o(st,2),Xt=i(St),aa=i(Xt),mt=o(Xt,2);{var nt=m=>{var z=Xn();_(m,z)};T(mt,m=>{n().contoTerzi&&m(nt)})}var sa=o(J,2),Gt=o(i(sa));{var Jt=m=>{var z=ts();z.__click=[Zn,f];var Q=i(z);R(()=>g(Q,`‚úèÔ∏è ${r(f)?"Annulla":"Modifica"}`)),_(m,z)};T(Gt,m=>{n().completata||m(Jt)})}var B=o(sa,2);{var yt=m=>{var z=rs(),Q=i(z);Bt(Q,1,()=>n().prodotti,Yt,(P,$,G)=>{var j=es(),ct=i(j),kt=o(ct,2),At=o(kt,2),Ft=o(At,2);Bt(Ft,21,()=>Br,Yt,(Z,bt)=>{var ot=as(),zt={},X=i(ot);R(()=>{zt!==(zt=r(bt))&&(ot.value=(ot.__value=r(bt))??""),g(X,r(bt))}),_(Z,ot)}),pt(ct,()=>r($).prodotto,Z=>(r($).prodotto=Z,De(e,"$currentLavorazione"))),pt(kt,()=>r($).kgAcquistati,Z=>(r($).kgAcquistati=Z,De(e,"$currentLavorazione"))),pt(At,()=>r($).costoKg,Z=>(r($).costoKg=Z,De(e,"$currentLavorazione"))),be(Ft,()=>r($).fornitore,Z=>(r($).fornitore=Z,De(e,"$currentLavorazione"))),_(P,j)});var H=o(Q,2);H.__click=y,_(m,z)},wt=m=>{var z=ss();Bt(z,5,()=>n().prodotti||[],Yt,(Q,H)=>{var P=ns(),$=i(P),G=i($),j=o($,2),ct=i(j),kt=i(ct),At=o(ct,2);{var Ft=ot=>{var zt=is(),X=i(zt);R($t=>g(X,`‚Ä¢ ${$t??""}/kg`),[()=>Ya(r(H).costoKg)]),_(ot,zt)};T(At,ot=>{r(H).costoKg>0&&ot(Ft)})}var Z=o(At,2);{var bt=ot=>{var zt=os(),X=i(zt);R($t=>g(X,`‚Üí ${$t??""} kg secco`),[()=>ta(r(H).kgSecco)]),_(ot,zt)};T(Z,ot=>{r(H).kgSecco&&ot(bt)})}R(ot=>{g(G,r(H).prodotto),g(kt,`${ot??""} kg`)},[()=>ta(r(H).kgAcquistati)]),_(Q,P)}),_(m,z)};T(B,m=>{r(f)?m(yt):m(wt,!1)})}var K=o(B,2),W=i(K),lt=o(K,2);{var Tt=m=>{var z=ds();Bt(z,5,()=>n().attivita,Yt,(Q,H)=>{var P=vs(),$=i(P),G=i($),j=i(G),ct=o(G,2),kt=i(ct),At=i(kt),Ft=o(kt,2);{var Z=vt=>{var Nt=cs();Nt.__click=[ls,A,H],_(vt,Nt)};T(Ft,vt=>{n().completata||vt(Z)})}var bt=o($,2),ot=i(bt);{var zt=vt=>{var Nt=ua();R(()=>g(Nt,`‚ö°40: ${r(H).oraAccensione40??""}${r(H).oraSpegnimento40?` - ${r(H).oraSpegnimento40}`:" (continua)"}`)),_(vt,Nt)};T(ot,vt=>{r(H).oraAccensione40&&vt(zt)})}var X=o(ot,2);{var $t=vt=>{var Nt=ua();R(()=>g(Nt,`${r(H).oraAccensione40?" | ":""}‚ö°100: ${r(H).oraAccensione100??""}${r(H).oraSpegnimento100?` - ${r(H).oraSpegnimento100}`:" (continua)"}`)),_(vt,Nt)};T(X,vt=>{r(H).oraAccensione100&&vt($t)})}R(vt=>{g(j,vt),g(At,`üë∑ ${r(H).oraInizioLavoro??""} - ${r(H).oraFineLavoro??""} (${r(H).numeroPersone??""}p)`)},[()=>qa(r(H).data)]),_(Q,P)}),_(m,z)},jt=m=>{var z=us();_(m,z)};T(lt,m=>{var z;((z=n().attivita)==null?void 0:z.length)>0?m(Tt):m(jt,!1)})}var ia=o(lt,2);{var Ut=m=>{var z=ps(),Q=o(Qa(z),2),H=i(Q),P=i(H),$=i(P),G=o(P,2),j=i(G),ct=o(H,2),kt=i(ct),At=i(kt),Ft=o(kt,2),Z=i(Ft),bt=o(ct,2),ot=i(bt),zt=i(ot),X=o(ot,2),$t=i(X),vt=o(bt,2),Nt=o(i(vt),2),Zt=i(Nt);R((ut,Pt,ga,oa,It,ja,Ua)=>{g($,`üë∑ Manodopera (${ut??""})`),g(j,Pt),g(At,`‚ö° Energia (${ga??""})`),g(Z,oa),g(zt,`ü•¨ Materia Prima (${It??""} kg)`),g($t,ja),g(Zt,Ua)},[()=>Ja(r(E).oreManodopera),()=>Ya(r(E).costoManodopera),()=>Ja(r(E).oreMacchinaTotali),()=>Ya(r(E).costoEnergia40+r(E).costoEnergia100),()=>ta(r(E).kgFreschiTotali),()=>Ya(r(E).costoMateriaPrimaTotale),()=>Ya(r(E).costoTotale)]),_(m,z)};T(ia,m=>{r(E)&&m(Ut)})}var et=o(ia,2);{var Mt=m=>{var z=fs(),Q=o(Qa(z),2),H=i(Q),P=i(H),$=o(i(P),2),G=o(P,2),j=o(i(G),2),ct=o(H,2),kt=i(ct),At=o(i(kt),2),Ft=o(kt,2),Z=o(i(Ft),2),bt=o(ct,2),ot=o(i(bt),4),zt=i(ot),X=i(zt),$t=o(i(X),2),vt=o(X,2),Nt=o(i(vt),2),Zt=o(vt,2),ut=o(i(Zt),2),Pt=o(Zt,2),ga=o(i(Pt),2),oa=o(bt,2);oa.__click=L,pt($,()=>r(v).data,It=>r(v).data=It),pt(j,()=>r(v).numeroPersone,It=>r(v).numeroPersone=It),pt(At,()=>r(v).oraInizioLavoro,It=>r(v).oraInizioLavoro=It),pt(Z,()=>r(v).oraFineLavoro,It=>r(v).oraFineLavoro=It),pt($t,()=>r(v).oraAccensione40,It=>r(v).oraAccensione40=It),pt(Nt,()=>r(v).oraSpegnimento40,It=>r(v).oraSpegnimento40=It),pt(ut,()=>r(v).oraAccensione100,It=>r(v).oraAccensione100=It),pt(ga,()=>r(v).oraSpegnimento100,It=>r(v).oraSpegnimento100=It),_(m,z)};T(et,m=>{n().completata||m(Mt)})}var ea=o(et,2),Vt=i(ea),S=i(Vt);S.__click=O;var F=o(S,2);F.__click=M;var V=o(Vt,2);{var U=m=>{var z=_s();z.__click=D,_(m,z)},ft=m=>{var z=bs();const Q=Rt(()=>{var G;return(G=n().prodotti)==null?void 0:G.some(j=>j.kgSecco&&parseFloat(j.kgSecco)>0)});z.__click=()=>le.set(!0);var H=i(z);{var P=G=>{var j=ua("üîí Richiudi Lavorazione");_(G,j)},$=G=>{var j=ua("‚úÖ Completa Lavorazione");_(G,j)};T(H,G=>{r(Q)?G(P):G($,!1)})}_(m,z)};T(V,m=>{n().completata?m(U):m(ft,!1)})}R((m,z)=>{var Q;g(tt,`üîÑ ${m??""}`),g(Ct,`üìÖ Iniziata il ${z??""}`),na(Xt,1,`badge ${n().completata?"badge-success":"badge-warning"}`),g(aa,n().completata?"‚úÖ Completata":"‚è≥ In corso"),g(W,`üìã Attivit√† (${(((Q=n().attivita)==null?void 0:Q.length)||0)??""})`)},[()=>{var m;return(m=n().prodotti)==null?void 0:m.map(z=>z.prodotto).join(", ")},()=>qa(n().dataInizio)]),_(w,k)},va=w=>{var k=ys(),I=i(k),J=o(i(I),2),st=o(i(J),2),q=o(J,2),tt=i(q),at=i(tt),Ct=o(q,4);Bt(Ct,17,()=>r(d).prodotti,Yt,(mt,nt,sa)=>{var Gt=hs(),Jt=i(Gt),B=i(Jt),yt=o(i(B),2),wt=o(B,2),K=o(i(wt),2);Bt(K,21,()=>Br,Yt,(et,Mt)=>{var ea=ms(),Vt={},S=i(ea);R(()=>{Vt!==(Vt=r(Mt))&&(ea.value=(ea.__value=r(Mt))??""),g(S,r(Mt))}),_(et,ea)});var W=o(wt,2),lt=o(i(W),2),Tt=o(W,2),jt=o(i(Tt),2),ia=o(Jt,2);{var Ut=et=>{var Mt=xs();Mt.__click=()=>p(sa),_(et,Mt)};T(ia,et=>{r(d).prodotti.length>1&&et(Ut)})}pt(yt,()=>r(nt).prodotto,et=>r(nt).prodotto=et),be(K,()=>r(nt).fornitore,et=>r(nt).fornitore=et),pt(lt,()=>r(nt).kgAcquistati,et=>r(nt).kgAcquistati=et),pt(jt,()=>r(nt).costoKg,et=>r(nt).costoKg=et),_(mt,Gt)});var St=o(Ct,2);St.__click=[Qn,d];var Xt=o(St,2),aa=i(Xt);aa.__click=h,pt(st,()=>r(d).dataInizio,mt=>r(d).dataInizio=mt),Li(at,()=>r(d).contoTerzi,mt=>r(d).contoTerzi=mt),_(w,k)};T(Qt,w=>{n()?w(it):w(va,!1)})}var ra=o(rt,2);{var C=w=>{var k=zs();const I=Rt(()=>{var K,W;return(W=(K=n())==null?void 0:K.prodotti)==null?void 0:W.some(lt=>lt.kgSecco&&parseFloat(lt.kgSecco)>0)});var J=i(k),st=i(J),q=i(st);{var tt=K=>{var W=ua("üîí Richiudi Lavorazione");_(K,W)},at=K=>{var W=ua("‚úÖ Completa Lavorazione");_(K,W)};T(q,K=>{r(I)?K(tt):K(at,!1)})}var Ct=o(st,2),St=i(Ct);{var Xt=K=>{var W=ua("Verifica i dati e conferma per ricreare i lotti:");_(K,W)},aa=K=>{var W=ua("Inserisci i kg secchi e la categoria per ogni prodotto:");_(K,W)};T(St,K=>{r(I)?K(Xt):K(aa,!1)})}var mt=o(Ct,2);Bt(mt,21,()=>r(b),Yt,(K,W,lt)=>{var Tt=ks(),jt=i(Tt),ia=i(jt),Ut=o(jt,2),et=i(Ut),Mt=o(Ut,2),ea=i(Mt),Vt=o(i(ea),2),S=o(ea,2),F=o(i(S),2);Bt(F,21,()=>Object.entries(hr),Yt,(V,U)=>{let ft=()=>r(U)[0],m=()=>r(U)[1];var z=ws(),Q={},H=i(z);R(()=>{Q!==(Q=ft())&&(z.value=(z.__value=ft())??""),g(H,`${m().emoji??""} ${m().nome??""}`)}),_(V,z)}),R((V,U)=>{g(ia,r(W).prodotto),g(et,`${V??""} kg freschi ‚Ä¢ ${U??""}/kg`)},[()=>ta(r(W).kgAcquistati),()=>Ya(r(W).costoKg)]),pt(Vt,()=>r(b)[lt].kgSecco,V=>r(b)[lt].kgSecco=V),be(F,()=>r(b)[lt].categoria,V=>r(b)[lt].categoria=V),_(K,Tt)});var nt=o(mt,2),sa=i(nt);sa.__click=()=>le.set(!1);var Gt=o(sa,2);Gt.__click=N;var Jt=i(Gt);{var B=K=>{var W=ua("üîí Richiudi e Ricrea Lotti");_(K,W)},yt=K=>{var W=ua("‚úÖ Completa e Crea Lotti");_(K,W)};T(Jt,K=>{r(I)?K(B):K(yt,!1)})}var wt=o(J,2);wt.__click=()=>le.set(!1),_(w,k)};T(ra,w=>{l()&&w(C)})}R(()=>g(Kt,n()?"Lavorazione":"Nuova Lavorazione")),_(t,_t),Sa(),s()}Ma(["click"]);async function Ss(t,a,e,s){var l;if(!r(a).prodotto.trim()){Ht("Inserisci il nome del prodotto");return}xt.set(!0),qt.set("Creazione lotto...");try{const n=new Date,c={prodotto:r(a).prodotto,categoria:r(a).categoria,dataInizio:n.toISOString().split("T")[0],kgSecco:parseFloat(r(a).kgSecco)||0,costoAlKg:parseFloat(r(a).costoAlKg)||0,prezzoAlKgIVA:(parseFloat(r(a).costoAlKg)||0)*1.3*1.04,fornitore:r(a).fornitore,tipo:"acquisto",lotNumberManuale:r(a).lotNumber.trim()||null,dataScadenza:r(a).dataScadenza||null},u=await gt.creaLotto(c);(l=e())==null||l(),ca(`Lotto ${u.lotNumber} creato!`),Y(s,!1),Y(a,{prodotto:"",categoria:"verdura",kgSecco:"",costoAlKg:"",fornitore:"acquistato",lotNumber:"",dataScadenza:""},!0)}catch(n){Ht(n.message)}finally{xt.set(!1),qt.set("")}}function Ts(t,a,e,s){Y(a,{note:"",righe:r(e).map(l=>({idLotto:l.id,lotNumber:l.lotNumber,productType:l.productType,kgOriginali:l.dryProductKg||0,kgRilevati:l.dryProductKg||0}))},!0),Y(s,!0)}async function As(t,a,e,s){var l;xt.set(!0),qt.set("Salvataggio inventario...");try{const n={id:Ba("INV"),data:new Date().toISOString(),note:r(a).note,righe:r(a).righe.map(c=>({idLotto:c.idLotto,lotNumber:c.lotNumber,productType:c.productType,kgRilevati:parseFloat(c.kgRilevati)||0}))};await gt.salvaInventario(n);for(const c of r(a).righe){const u=parseFloat(c.kgRilevati)||0,d=parseFloat(c.kgOriginali)||0;u!==d&&await gt.aggiornaLotto(c.idLotto,{dryProductKg:u})}(l=e())==null||l(),ca("Inventario registrato!"),Y(s,!1)}catch(n){Ht(n.message)}finally{xt.set(!1),qt.set("")}}async function Es(t,a,e){try{const s=await gt.getInventari();Y(a,s,!0),Y(e,!0)}catch(s){Ht(s.message)}}async function Ds(t,a,e,s,l){xt.set(!0),qt.set("Generazione report...");try{r(a).length===0&&Y(a,await gt.getInventari(),!0);const n=r(a).length>0?r(a)[0]:null;Y(e,s().filter(c=>!c.esaurito).map(c=>{const u=parseFloat(c.dryProductKg)||0;let d=u;if(n!=null&&n.righe){const f=n.righe.find(p=>p.idLotto===c.id);f&&(d=parseFloat(f.kgRilevati)||0)}const v=u-d,b=u>0?v/u*100:0;return{lotNumber:c.lotNumber,productType:c.productType,productCategory:c.productCategory,processingDate:c.processingDate,kgProdotti:u,kgInventario:d,kgUsati:v,percentualeUsata:b}}).filter(c=>c.kgProdotti>0).sort((c,u)=>u.percentualeUsata-c.percentualeUsata),!0),Y(l,!0)}catch(n){Ht(n.message)}finally{xt.set(!1),qt.set("")}}function Ls(t,a,e){const s=new Date().toLocaleDateString("it-IT"),l=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Report Consumo - ${s}</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { color: #333; border-bottom: 2px solid #10b981; padding-bottom: 10px; }
    .stats { display: flex; gap: 20px; margin: 20px 0; }
    .stat { background: #f3f4f6; padding: 15px; border-radius: 8px; text-align: center; flex: 1; }
    .stat-value { font-size: 24px; font-weight: bold; color: #10b981; }
    .stat-label { font-size: 12px; color: #666; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th { background: #10b981; color: white; padding: 10px; text-align: left; }
    td { padding: 8px; border-bottom: 1px solid #ddd; }
    tr:nth-child(even) { background: #f9fafb; }
    .footer { margin-top: 30px; text-align: center; color: #999; font-size: 12px; }
    .high { color: #ef4444; font-weight: bold; }
    .medium { color: #f59e0b; }
    .low { color: #10b981; }
    @media print { body { padding: 0; } }
  </style>
</head>
<body>
  <h1>üìä Report Consumo Prodotti</h1>
  <p>Data: ${s}</p>
  
  <div class="stats">
    <div class="stat">
      <div class="stat-value">${ta(r(a).kgProdottiTot)} kg</div>
      <div class="stat-label">Prodotti</div>
    </div>
    <div class="stat">
      <div class="stat-value">${ta(r(a).kgInventarioTot)} kg</div>
      <div class="stat-label">In Magazzino</div>
    </div>
    <div class="stat">
      <div class="stat-value">${ta(r(a).kgUsatiTot)} kg</div>
      <div class="stat-label">Usati/Venduti</div>
    </div>
  </div>
  
  <table>
    <thead>
      <tr>
        <th>Lotto</th>
        <th>Prodotto</th>
        <th>Kg Prodotti</th>
        <th>Kg Magazzino</th>
        <th>Kg Usati</th>
        <th>%</th>
      </tr>
    </thead>
    <tbody>
      ${r(e).map(c=>`
        <tr>
          <td>${c.lotNumber}</td>
          <td>${c.productType}</td>
          <td>${ta(c.kgProdotti)} kg</td>
          <td>${ta(c.kgInventario)} kg</td>
          <td>${ta(c.kgUsati)} kg</td>
          <td class="${c.percentualeUsata>75?"high":c.percentualeUsata>50?"medium":"low"}">${c.percentualeUsata.toFixed(0)}%</td>
        </tr>
      `).join("")}
    </tbody>
  </table>
  
  <div class="footer">
    Report generato dal Gestionale Disidratazione ‚Ä¢ ${s}
  </div>
</body>
</html>
    `,n=window.open("","_blank");n.document.write(l),n.document.close(),n.print()}var Cs=(t,a)=>Y(a,!0),Is=(t,a)=>Y(a,"tutti"),Os=(t,a)=>Y(a,"disponibili"),Ms=(t,a)=>Y(a,"esauriti"),Fs=(t,a,e)=>Y(a,r(a)===e()?null:e(),!0),Ns=x('<div class="text-right"><p class="text-xs text-base-content/50">Costo Prod. Kg</p> <p class="font-bold text-primary"> </p> <p class="text-xs text-success"> </p></div>'),Rs=x('<span title="Scadenza"> </span>'),qs=x('<span class="badge badge-xs badge-outline badge-warning" title="Conto Terzi">üë§</span>'),Ks=(t,a,e)=>a(r(e)),js=x('<div><div class="flex items-center gap-2 flex-wrap"><span class="font-mono font-bold"> </span> <span class="text-base-content/60"> </span> <span class="text-base-content/40"> </span> <!> <span> </span> <!></div> <button> </button></div>'),Us=x('<div class="card bg-base-200/50"><div class="card-body p-3"><div class="flex justify-between items-start"><div><h4 class="font-bold"> </h4> <p class="text-xs text-base-content/60"> </p></div> <!></div> <div class="space-y-1 mt-2"></div></div></div>'),Vs=x('<div class="collapse collapse-arrow bg-base-100 shadow"><input type="checkbox"/> <div class="collapse-title font-medium flex items-center gap-2"><span class="text-xl"> </span> <span> </span> <span> </span> <span class="badge badge-ghost badge-sm"> </span></div> <div class="collapse-content space-y-3 pt-2"></div></div>'),Hs=x('<div class="text-center py-8 text-base-content/50"><p class="text-4xl mb-2">üì¶</p> <p>Nessun lotto trovato</p></div>'),Ys=x("<option> </option>"),Bs=(t,a)=>Y(a,!1),Gs=(t,a)=>Y(a,!1),Js=x('<div class="modal modal-open"><div class="modal-box"><h3 class="font-bold text-lg">‚ûï Nuovo Lotto (Acquisto)</h3> <div class="form-control mt-4"><label class="label"><span class="label-text">Prodotto *</span></label> <input type="text" placeholder="Es: Mela essiccata" class="input input-bordered"/></div> <div class="form-control mt-3"><label class="label"><span class="label-text">Categoria</span></label> <select class="select select-bordered"></select></div> <div class="grid grid-cols-2 gap-3 mt-3"><div class="form-control"><label class="label"><span class="label-text">Kg secchi</span></label> <input type="number" step="0.01" placeholder="0.00" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">‚Ç¨/kg</span></label> <input type="number" step="0.01" placeholder="0.00" class="input input-bordered"/></div></div> <div class="divider text-xs">Dati fornitore (opzionali)</div> <div class="grid grid-cols-2 gap-3"><div class="form-control"><label class="label"><span class="label-text">üì¶ N¬∞ Lotto fornitore</span></label> <input type="text" placeholder="Es: LOT2024-123" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">üìÖ Data scadenza</span></label> <input type="date" class="input input-bordered"/></div></div> <div class="modal-action"><button class="btn btn-ghost">Annulla</button> <button class="btn btn-primary">‚úÖ Crea Lotto</button></div></div> <div class="modal-backdrop"></div></div>'),Ws=x('<div class="flex items-center gap-3 p-2 bg-base-200/50 rounded-lg"><div class="flex-1"><span class="font-mono text-sm font-bold"> </span> <span class="text-sm ml-2"> </span></div> <div class="text-xs text-base-content/50"> </div> <input type="number" step="0.01" class="input input-bordered input-sm w-24"/> <span class="text-xs">kg</span></div>'),Qs=x('<div class="space-y-2 max-h-96 overflow-y-auto"></div> <div class="form-control mt-4"><label class="label"><span class="label-text">Note (opzionale)</span></label> <textarea class="textarea textarea-bordered" placeholder="Eventuali annotazioni..."></textarea></div>',1),Xs=x(`<p class="text-center py-8 text-base-content/50">Nessun lotto disponibile per l'inventario</p>`),Zs=(t,a)=>Y(a,!1),tl=(t,a)=>Y(a,!1),al=x('<div class="modal modal-open"><div class="modal-box max-w-2xl max-h-[90vh]"><h3 class="font-bold text-lg">üìã Registrazione Inventario</h3> <p class="text-sm text-base-content/60 mt-1"> </p> <div class="divider"></div> <!> <div class="modal-action"><button class="btn btn-ghost">Annulla</button> <button class="btn btn-primary">üíæ Salva Inventario</button></div></div> <div class="modal-backdrop"></div></div>'),el=x('<p class="text-sm mt-1"> </p>'),rl=(t,a,e)=>a(r(e).id),il=x('<div class="flex justify-between"><span> </span> <span class="font-bold"> </span></div>'),ol=x('<div class="mt-2 text-xs space-y-1"></div>'),nl=x('<div class="card bg-base-200"><div class="card-body p-4"><div class="flex justify-between items-start"><div><h4 class="font-bold"> </h4> <p class="text-xs text-base-content/60"> </p> <!></div> <button class="btn btn-ghost btn-xs text-error">üóëÔ∏è</button></div> <!></div></div>'),sl=x('<div class="space-y-3 max-h-96 overflow-y-auto"></div>'),ll=x('<p class="text-center py-8 text-base-content/50">Nessun inventario registrato</p>'),cl=(t,a)=>Y(a,!1),vl=(t,a)=>Y(a,!1),dl=x('<div class="modal modal-open"><div class="modal-box max-w-2xl max-h-[90vh]"><h3 class="font-bold text-lg">üìö Storico Inventari</h3> <div class="divider"></div> <!> <div class="modal-action"><button class="btn">Chiudi</button></div></div> <div class="modal-backdrop"></div></div>'),ul=x('<tr><td class="font-mono"> </td><td> </td><td class="text-right"> </td><td class="text-right text-success"> </td><td class="text-right text-warning"> </td><td class="text-right"><span> </span></td></tr>'),pl=x('<div class="overflow-x-auto max-h-80"><table class="table table-xs table-zebra"><thead class="sticky top-0 bg-base-100"><tr><th>Lotto</th><th>Prodotto</th><th class="text-right">Prodotti</th><th class="text-right">Magazzino</th><th class="text-right">Usati</th><th class="text-right">%</th></tr></thead><tbody></tbody></table></div>'),fl=x('<p class="text-center py-8 text-base-content/50">Nessun dato disponibile. Registra prima un inventario.</p>'),_l=(t,a)=>Y(a,!1),bl=(t,a)=>Y(a,!1),gl=x('<div class="modal modal-open"><div class="modal-box max-w-3xl max-h-[90vh]"><h3 class="font-bold text-lg">üìä Report Consumo</h3> <p class="text-sm text-base-content/60">Confronto tra produzione e ultimo inventario</p> <div class="stats stats-horizontal shadow w-full mt-4 bg-base-200"><div class="stat p-3"><div class="stat-title text-xs">Prodotti</div> <div class="stat-value text-lg text-primary"> </div></div> <div class="stat p-3"><div class="stat-title text-xs">In magazzino</div> <div class="stat-value text-lg text-success"> </div></div> <div class="stat p-3"><div class="stat-title text-xs">Usati/Venduti</div> <div class="stat-value text-lg text-warning"> </div></div></div> <div class="divider"></div> <!> <div class="modal-action"><button class="btn btn-success">üìä Excel</button> <button class="btn btn-info">üìÑ PDF</button> <button class="btn">Chiudi</button></div></div> <div class="modal-backdrop"></div></div>'),ml=x('<div class="space-y-4"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-accent rounded-full"></div> <h2 class="text-lg font-bold">Lotti</h2></div> <div class="stats stats-horizontal shadow w-full bg-base-100"><div class="stat p-3"><div class="stat-title text-xs">Totali</div> <div class="stat-value text-xl text-primary"> </div></div> <div class="stat p-3"><div class="stat-title text-xs">Disponibili</div> <div class="stat-value text-xl text-success"> </div></div> <div class="stat p-3"><div class="stat-title text-xs">Esauriti</div> <div class="stat-value text-xl text-error"> </div></div></div> <div class="flex gap-2"><button class="btn btn-primary btn-sm flex-1">‚ûï Lotto</button> <button class="btn btn-secondary btn-sm flex-1">üìã Inventario</button> <button class="btn btn-accent btn-sm flex-1">üìä Consumo</button> <button class="btn btn-ghost btn-sm" title="Storico inventari">üìö</button></div> <div class="space-y-2"><input type="text" placeholder="üîç Cerca prodotto o lotto..." class="input input-bordered w-full"/> <div class="flex gap-2 flex-wrap"><button> </button> <button> </button> <button> </button></div></div> <div class="space-y-2"><!> <!></div></div> <!> <!> <!> <!>',1);function xl(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(Na,"$lotti",e),n=()=>Lt(ze,"$stats",e);let c=Ca(a,"onreload",3,null),u=ht(""),d=ht("tutti"),v=ht(null),b=ht(!1),f=ht(!1),p=ht(!1),h=ht(!1),y=ht(fa([])),L=ht(fa([])),A=ht(fa({prodotto:"",categoria:"verdura",kgSecco:"",costoAlKg:"",fornitore:"acquistato",lotNumber:"",dataScadenza:""})),N=ht(fa({note:"",righe:[]})),D=Rt(()=>l().filter(S=>{if(r(d)==="disponibili"&&S.esaurito||r(d)==="esauriti"&&!S.esaurito)return!1;if(r(u).trim()){const F=r(u).toLowerCase();return(S.productType||"").toLowerCase().includes(F)||(S.lotNumber||"").toLowerCase().includes(F)}return!0})),M=Rt(()=>r(D).reduce((S,F)=>{const V=F.productCategory||"altro";S[V]||(S[V]={});const U=F.productType||"Sconosciuto";return S[V][U]||(S[V][U]=[]),S[V][U].push(F),S},{})),E=Rt(()=>l().filter(S=>!S.esaurito));async function O(S){try{await gt.toggleEsaurito(S.id,!S.esaurito),Na.update(F=>F.map(V=>V.id===S.id?{...V,esaurito:!V.esaurito}:V)),ca(S.esaurito?"Lotto riattivato":"Lotto esaurito")}catch(F){Ht(F.message)}}async function _t(S){if(confirm("Eliminare questo inventario?"))try{await gt.eliminaInventario(S),Y(y,r(y).filter(F=>F.id!==S),!0),ca("Inventario eliminato")}catch(F){Ht(F.message)}}let rt=Rt(()=>({kgProdottiTot:r(L).reduce((S,F)=>S+F.kgProdotti,0),kgInventarioTot:r(L).reduce((S,F)=>S+F.kgInventario,0),kgUsatiTot:r(L).reduce((S,F)=>S+F.kgUsati,0)}));function dt(){const S=["Lotto","Prodotto","Categoria","Data Produzione","Kg Prodotti","Kg Magazzino","Kg Usati","% Usata"],F=r(L).map(z=>[z.lotNumber,z.productType,z.productCategory||"",z.processingDate||"",z.kgProdotti.toFixed(2),z.kgInventario.toFixed(2),z.kgUsati.toFixed(2),z.percentualeUsata.toFixed(1)+"%"]);F.push([]),F.push(["TOTALE","","","",r(rt).kgProdottiTot.toFixed(2),r(rt).kgInventarioTot.toFixed(2),r(rt).kgUsatiTot.toFixed(2),""]);const V=[S,...F].map(z=>z.map(Q=>`"${Q}"`).join(";")).join(`
`),U=new Blob(["\uFEFF"+V],{type:"text/csv;charset=utf-8;"}),ft=URL.createObjectURL(U),m=document.createElement("a");m.href=ft,m.download=`Report_Consumo_${new Date().toISOString().split("T")[0]}.csv`,m.click(),URL.revokeObjectURL(ft),ca("Excel scaricato!")}var Wt=ml(),Kt=Qa(Wt),Qt=o(i(Kt),2),it=i(Qt),va=o(i(it),2),ra=i(va),C=o(it,2),w=o(i(C),2),k=i(w),I=o(C,2),J=o(i(I),2),st=i(J),q=o(Qt,2),tt=i(q);tt.__click=[Cs,b];var at=o(tt,2);at.__click=[Ts,N,E,f];var Ct=o(at,2);Ct.__click=[Ds,y,L,l,h];var St=o(Ct,2);St.__click=[Es,y,p];var Xt=o(q,2),aa=i(Xt),mt=o(aa,2),nt=i(mt);nt.__click=[Is,d];var sa=i(nt),Gt=o(nt,2);Gt.__click=[Os,d];var Jt=i(Gt),B=o(Gt,2);B.__click=[Ms,d];var yt=i(B),wt=o(Xt,2),K=i(wt);Bt(K,17,()=>Object.entries(hr),Yt,(S,F)=>{let V=()=>r(F)[0],U=()=>r(F)[1];var ft=Ei(),m=Qa(ft);{var z=Q=>{var H=Vs();const P=Rt(()=>Object.keys(r(M)[V()]).length),$=Rt(()=>Object.values(r(M)[V()]).flat().length);var G=i(H);G.__change=[Fs,v,V];var j=o(G,2),ct=i(j),kt=i(ct),At=o(ct,2),Ft=i(At),Z=o(At,2),bt=i(Z),ot=o(Z,2),zt=i(ot),X=o(j,2);Bt(X,21,()=>Object.entries(r(M)[V()]),Yt,($t,vt)=>{let Nt=()=>r(vt)[0],Zt=()=>r(vt)[1];var ut=Us();const Pt=Rt(()=>Zt().filter(la=>!la.esaurito)),ga=Rt(()=>r(Pt).reduce((la,Et)=>la+(parseFloat(Et.dryProductKg)||0),0)),oa=Rt(()=>Zt().filter(la=>la.costPerKgDry>0)),It=Rt(()=>r(oa).length>0?r(oa).reduce((la,Et)=>la+parseFloat(Et.costPerKgDry),0)/r(oa).length:0),ja=Rt(()=>r(oa).length>0?r(oa).reduce((la,Et)=>la+parseFloat(Et.pricePerKgVat||0),0)/r(oa).length:0);var Ua=i(ut),ie=i(Ua),te=i(ie),oe=i(te),$e=i(oe),rr=o(oe,2),ir=i(rr),Pe=o(te,2);{var or=la=>{var Et=Ns(),Va=o(i(Et),2),Se=i(Va),Te=o(Va,2),sr=i(Te);R((Ae,lr)=>{g(Se,`${Ae??""}/kg`),g(sr,`+IVA ${lr??""}/kg`)},[()=>Ya(r(It)),()=>Ya(r(ja))]),_(la,Et)};T(Pe,la=>{r(It)>0&&la(or)})}var nr=o(ie,2);Bt(nr,21,Zt,Yt,(la,Et)=>{var Va=js(),Se=i(Va),Te=i(Se),sr=i(Te),Ae=o(Te,2),lr=i(Ae),Lr=o(Ae,2),Ni=i(Lr),Cr=o(Lr,2);{var Ri=Fa=>{var ae=Rs(),dr=i(ae);R((Vi,Hi)=>{na(ae,1,`badge badge-xs ${Vi??""}`),g(dr,`‚è∞ ${Hi??""}`)},[()=>Jr(r(Et).dataScadenza)?"badge-error":Gr(r(Et).dataScadenza)?"badge-warning":"badge-ghost",()=>An(r(Et).dataScadenza)]),_(Fa,ae)};T(Cr,Fa=>{r(Et).dataScadenza&&Fa(Ri)})}var cr=o(Cr,2),qi=i(cr),Ki=o(cr,2);{var ji=Fa=>{var ae=qs();_(Fa,ae)};T(Ki,Fa=>{r(Et).contoTerzi&&Fa(ji)})}var vr=o(Se,2);vr.__click=[Ks,O,Et];var Ui=i(vr);R((Fa,ae,dr)=>{na(Va,1,`flex justify-between items-center p-2 rounded-lg text-xs ${Fa??""}`),g(sr,r(Et).lotNumber),g(lr,`${ae??""} kg`),g(Ni,dr),Qo(cr,"title",r(Et).tipo==="acquisto"?"Acquistato":"Produzione"),g(qi,r(Et).tipo==="acquisto"?"üõí":"üè≠"),na(vr,1,`btn btn-xs ${r(Et).esaurito?"btn-error":"btn-success"}`),g(Ui,r(Et).esaurito?"‚ùå":"‚úÖ")},[()=>r(Et).esaurito?"bg-error/10":Jr(r(Et).dataScadenza)?"bg-error/20":Gr(r(Et).dataScadenza)?"bg-warning/20":"bg-success/10",()=>ta(r(Et).dryProductKg),()=>qa(r(Et).processingDate)]),_(la,Va)}),R(la=>{g($e,Nt()),g(ir,`${r(Pt).length??""} disponibil${r(Pt).length===1?"e":"i"} ‚Ä¢ ${la??""} kg`)},[()=>ta(r(ga))]),_($t,ut)}),R(()=>{Wo(G,r(v)===V()),g(kt,U().emoji),g(Ft,U().nome),na(Z,1,`badge badge-${U().colore??""} badge-sm`),g(bt,`${r(P)??""} prodotti`),g(zt,`${r($)??""} lotti`)}),_(Q,H)};T(m,Q=>{r(M)[V()]&&Q(z)})}_(S,ft)});var W=o(K,2);{var lt=S=>{var F=Hs();_(S,F)};T(W,S=>{Object.keys(r(M)).length===0&&S(lt)})}var Tt=o(Kt,2);{var jt=S=>{var F=Js(),V=i(F),U=o(i(V),2),ft=o(i(U),2),m=o(U,2),z=o(i(m),2);Bt(z,21,()=>Object.entries(hr),Yt,(X,$t)=>{let vt=()=>r($t)[0],Nt=()=>r($t)[1];var Zt=Ys(),ut={},Pt=i(Zt);R(()=>{ut!==(ut=vt())&&(Zt.value=(Zt.__value=vt())??""),g(Pt,`${Nt().emoji??""} ${Nt().nome??""}`)}),_(X,Zt)});var Q=o(m,2),H=i(Q),P=o(i(H),2),$=o(H,2),G=o(i($),2),j=o(Q,4),ct=i(j),kt=o(i(ct),2),At=o(ct,2),Ft=o(i(At),2),Z=o(j,2),bt=i(Z);bt.__click=[Bs,b];var ot=o(bt,2);ot.__click=[Ss,A,c,b];var zt=o(V,2);zt.__click=[Gs,b],pt(ft,()=>r(A).prodotto,X=>r(A).prodotto=X),be(z,()=>r(A).categoria,X=>r(A).categoria=X),pt(P,()=>r(A).kgSecco,X=>r(A).kgSecco=X),pt(G,()=>r(A).costoAlKg,X=>r(A).costoAlKg=X),pt(kt,()=>r(A).lotNumber,X=>r(A).lotNumber=X),pt(Ft,()=>r(A).dataScadenza,X=>r(A).dataScadenza=X),_(S,F)};T(Tt,S=>{r(b)&&S(jt)})}var ia=o(Tt,2);{var Ut=S=>{var F=al(),V=i(F),U=o(i(V),2),ft=i(U),m=o(U,4);{var z=j=>{var ct=Qs(),kt=Qa(ct);Bt(kt,21,()=>r(N).righe,Yt,(Z,bt,ot)=>{var zt=Ws(),X=i(zt),$t=i(X),vt=i($t),Nt=o($t,2),Zt=i(Nt),ut=o(X,2),Pt=i(ut),ga=o(ut,2);R(oa=>{g(vt,r(bt).lotNumber),g(Zt,r(bt).productType),g(Pt,`(${oa??""} kg)`)},[()=>ta(r(bt).kgOriginali)]),pt(ga,()=>r(N).righe[ot].kgRilevati,oa=>r(N).righe[ot].kgRilevati=oa),_(Z,zt)});var At=o(kt,2),Ft=o(i(At),2);pt(Ft,()=>r(N).note,Z=>r(N).note=Z),_(j,ct)},Q=j=>{var ct=Xs();_(j,ct)};T(m,j=>{r(N).righe.length>0?j(z):j(Q,!1)})}var H=o(m,2),P=i(H);P.__click=[Zs,f];var $=o(P,2);$.__click=[As,N,c,f];var G=o(V,2);G.__click=[tl,f],R(j=>{g(ft,`${j??""} ‚Ä¢ ${r(E).length??""} lotti disponibili`),$.disabled=r(N).righe.length===0},[()=>new Date().toLocaleDateString("it-IT")]),_(S,F)};T(ia,S=>{r(f)&&S(Ut)})}var et=o(ia,2);{var Mt=S=>{var F=dl(),V=i(F),U=o(i(V),4);{var ft=P=>{var $=sl();Bt($,21,()=>r(y),Yt,(G,j)=>{var ct=nl(),kt=i(ct),At=i(kt),Ft=i(At),Z=i(Ft),bt=i(Z),ot=o(Z,2),zt=i(ot),X=o(ot,2);{var $t=ut=>{var Pt=el(),ga=i(Pt);R(()=>g(ga,r(j).note)),_(ut,Pt)};T(X,ut=>{r(j).note&&ut($t)})}var vt=o(Ft,2);vt.__click=[rl,_t,j];var Nt=o(At,2);{var Zt=ut=>{var Pt=ol();Bt(Pt,21,()=>r(j).righe,Yt,(ga,oa)=>{var It=il(),ja=i(It),Ua=i(ja),ie=o(ja,2),te=i(ie);R(oe=>{g(Ua,`${r(oa).lotNumber??""} - ${r(oa).productType??""}`),g(te,`${oe??""} kg`)},[()=>ta(r(oa).kgRilevati)]),_(ga,It)}),_(ut,Pt)};T(Nt,ut=>{var Pt;((Pt=r(j).righe)==null?void 0:Pt.length)>0&&ut(Zt)})}R(ut=>{var Pt;g(bt,ut),g(zt,`${(((Pt=r(j).righe)==null?void 0:Pt.length)||0)??""} lotti registrati`)},[()=>Fi(r(j).data)]),_(G,ct)}),_(P,$)},m=P=>{var $=ll();_(P,$)};T(U,P=>{r(y).length>0?P(ft):P(m,!1)})}var z=o(U,2),Q=i(z);Q.__click=[cl,p];var H=o(V,2);H.__click=[vl,p],_(S,F)};T(et,S=>{r(p)&&S(Mt)})}var ea=o(et,2);{var Vt=S=>{var F=gl(),V=i(F),U=o(i(V),4),ft=i(U),m=o(i(ft),2),z=i(m),Q=o(ft,2),H=o(i(Q),2),P=i(H),$=o(Q,2),G=o(i($),2),j=i(G),ct=o(U,4);{var kt=X=>{var $t=pl(),vt=i($t),Nt=o(i(vt));Bt(Nt,21,()=>r(L),Yt,(Zt,ut)=>{var Pt=ul(),ga=i(Pt),oa=i(ga),It=o(ga),ja=i(It),Ua=o(It),ie=i(Ua),te=o(Ua),oe=i(te),$e=o(te),rr=i($e),ir=o($e),Pe=i(ir),or=i(Pe);R((nr,la,Et,Va)=>{g(oa,r(ut).lotNumber),g(ja,r(ut).productType),g(ie,`${nr??""} kg`),g(oe,`${la??""} kg`),g(rr,`${Et??""} kg`),na(Pe,1,`badge badge-sm ${r(ut).percentualeUsata>75?"badge-error":r(ut).percentualeUsata>50?"badge-warning":"badge-success"}`),g(or,`${Va??""}%`)},[()=>ta(r(ut).kgProdotti),()=>ta(r(ut).kgInventario),()=>ta(r(ut).kgUsati),()=>r(ut).percentualeUsata.toFixed(0)]),_(Zt,Pt)}),_(X,$t)},At=X=>{var $t=fl();_(X,$t)};T(ct,X=>{r(L).length>0?X(kt):X(At,!1)})}var Ft=o(ct,2),Z=i(Ft);Z.__click=dt;var bt=o(Z,2);bt.__click=[Ls,rt,L];var ot=o(bt,2);ot.__click=[_l,h];var zt=o(V,2);zt.__click=[bl,h],R((X,$t,vt)=>{g(z,`${X??""} kg`),g(P,`${$t??""} kg`),g(j,`${vt??""} kg`)},[()=>ta(r(rt).kgProdottiTot),()=>ta(r(rt).kgInventarioTot),()=>ta(r(rt).kgUsatiTot)]),_(S,F)};T(ea,S=>{r(h)&&S(Vt)})}R(()=>{g(ra,n().lottiTotali),g(k,n().lottiDisponibili),g(st,n().lottiEsauriti),na(nt,1,`btn btn-sm ${r(d)==="tutti"?"btn-primary":"btn-ghost"}`),g(sa,`Tutti (${n().lottiTotali??""})`),na(Gt,1,`btn btn-sm ${r(d)==="disponibili"?"btn-success":"btn-ghost"}`),g(Jt,`Disponibili (${n().lottiDisponibili??""})`),na(B,1,`btn btn-sm ${r(d)==="esauriti"?"btn-error":"btn-ghost"}`),g(yt,`Esauriti (${n().lottiEsauriti??""})`)}),pt(aa,()=>r(u),S=>Y(u,S)),_(t,Wt),Sa(),s()}Ma(["click","change"]);function hl(t,a,e){Y(a,null),e()}async function Wr(t,a,e,s,l,n){var u,d;if(!a.some(v=>r(e)[v.key])){Ht("Seleziona almeno una operazione");return}xt.set(!0),qt.set(r(s)?"Aggiornamento...":"Salvataggio...");try{const v={id:((u=r(s))==null?void 0:u.id)||Ba("PUL"),...r(e)};await gt.salvaPulizia(v),(d=l())==null||d(),ca(r(s)?"Pulizia aggiornata!":"Pulizia registrata!"),Y(s,null),n()}catch(v){Ht(v.message)}finally{xt.set(!1),qt.set("")}}var yl=x('<label class="label cursor-pointer justify-start gap-2 bg-base-200/50 hover:bg-base-200 rounded-lg p-3 transition-colors"><input type="checkbox" class="checkbox checkbox-sm checkbox-success"/> <span class="text-lg"> </span> <span class="label-text text-sm"> </span></label>'),wl=x('<button class="btn btn-ghost">‚ùå Annulla</button> <button class="btn btn-warning">üíæ Salva Modifiche</button>',1),kl=x('<button class="btn btn-warning btn-block lg:btn-wide">‚úÖ Registra Pulizia</button>'),zl=x('<span title="Piano lavoro">üßº</span>'),$l=x('<span title="Lavello">üö∞</span>'),Pl=x('<span title="Tagliaverdure">üî™</span>'),Sl=x('<span title="Spazzatura pavimento">üßπ</span>'),Tl=x('<span title="Lavaggio detergente">üß¥</span>'),Al=x('<span title="Disidratatore">‚ö°</span>'),El=x('<span title="Ceste">üß∫</span>'),Dl=x('<span title="Retine">üï∏Ô∏è</span>'),Ll=x('<span title="Controllo ragnatele">üï∑Ô∏è</span>'),Cl=x('<p class="text-xs text-base-content/50 mt-1"> </p>'),Il=(t,a,e)=>a(r(e)),Ol=(t,a,e)=>a(r(e).id),Ml=x('<div class="flex justify-between items-center p-3 bg-base-200/50 rounded-lg"><div><div class="font-medium"> </div> <div class="flex gap-1 mt-1"><!> <!> <!> <!> <!> <!> <!> <!> <!></div> <!></div> <div class="flex gap-1"><button class="btn btn-ghost btn-xs">‚úèÔ∏è</button> <button class="btn btn-ghost btn-xs text-error">üóëÔ∏è</button></div></div>'),Fl=x('<div class="card bg-base-100 shadow"><div class="card-body p-4"><h3 class="font-semibold flex items-center gap-2">üìã Storico Pulizie <span class="badge badge-ghost badge-sm"> </span></h3> <div class="space-y-2 mt-3 max-h-96 overflow-y-auto"></div></div></div>'),Nl=x('<div class="text-center py-8 text-base-content/50"><p class="text-4xl mb-2">üßπ</p> <p>Nessuna pulizia registrata</p></div>'),Rl=x('<div class="space-y-4"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-warning rounded-full"></div> <h2 class="text-lg font-bold">Pulizie HACCP</h2></div> <div class="card bg-base-100 shadow-lg"><div class="card-body"><h3 class="card-title text-warning"> </h3> <div class="form-control mt-4"><label class="label"><span class="label-text">üìÖ Data</span></label> <input type="date" class="input input-bordered"/></div> <div class="divider text-sm">Operazioni effettuate</div> <div class="grid grid-cols-2 lg:grid-cols-3 gap-2"></div> <div class="form-control mt-4"><label class="label"><span class="label-text">üß¥ Prodotto utilizzato</span></label> <input type="text" class="input input-bordered" placeholder="Es: Detergente neutro"/></div> <div class="form-control mt-3"><label class="label"><span class="label-text">üìù Note (opzionale)</span></label> <textarea class="textarea textarea-bordered" placeholder="Eventuali annotazioni..."></textarea></div> <div class="card-actions justify-end mt-4"><!></div></div></div> <!></div>');function ql(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(ve,"$pulizie",e);let n=Ca(a,"onreload",3,null),c=ht(null),u=ht(fa({data:new Date().toISOString().split("T")[0],locale:"Laboratorio",pianoLavoro:!1,lavello:!1,tagliaverdure:!1,spazzaturaPavimento:!1,lavaggioPavimentoDetergente:!1,disidratatore:!1,ceste:!1,retine:!1,controlloRagnatele:!1,prodottoUtilizzato:"",angoliScaffali:"",esito:"Conforme",note:"",operatore:"Emanuele Visigalli"}));const d=[{key:"pianoLavoro",label:"Piano lavoro",icon:"üßº"},{key:"lavello",label:"Lavello",icon:"üö∞"},{key:"tagliaverdure",label:"Tagliaverdure",icon:"üî™"},{key:"spazzaturaPavimento",label:"Spazzatura pavimento",icon:"üßπ"},{key:"lavaggioPavimentoDetergente",label:"Lavaggio detergente",icon:"üß¥"},{key:"disidratatore",label:"Disidratatore",icon:"‚ö°"},{key:"ceste",label:"Ceste",icon:"üß∫"},{key:"retine",label:"Retine",icon:"üï∏Ô∏è"},{key:"controlloRagnatele",label:"Controllo ragnatele",icon:"üï∑Ô∏è"}];function v(C){Y(c,C,!0),Y(u,{data:C.data,locale:C.locale||"Laboratorio",pianoLavoro:!!C.pianoLavoro,lavello:!!C.lavello,tagliaverdure:!!C.tagliaverdure,spazzaturaPavimento:!!C.spazzaturaPavimento,lavaggioPavimentoDetergente:!!C.lavaggioPavimentoDetergente,disidratatore:!!C.disidratatore,ceste:!!C.ceste,retine:!!C.retine,controlloRagnatele:!!C.controlloRagnatele,prodottoUtilizzato:C.prodottoUtilizzato||"",angoliScaffali:C.angoliScaffali||"",esito:C.esito||"Conforme",note:C.note||"",operatore:C.operatore||"Emanuele Visigalli"},!0)}function b(){Y(u,{data:new Date().toISOString().split("T")[0],locale:"Laboratorio",pianoLavoro:!1,lavello:!1,tagliaverdure:!1,spazzaturaPavimento:!1,lavaggioPavimentoDetergente:!1,disidratatore:!1,ceste:!1,retine:!1,controlloRagnatele:!1,prodottoUtilizzato:"",angoliScaffali:"",esito:"Conforme",note:"",operatore:"Emanuele Visigalli"},!0)}async function f(C){if(confirm("Eliminare questa pulizia?"))try{await gt.eliminaPulizia(C),ve.update(w=>w.filter(k=>k.id!==C)),ca("Pulizia eliminata")}catch(w){Ht(w.message)}}var p=Rl(),h=o(i(p),2),y=i(h),L=i(y),A=i(L),N=o(L,2),D=o(i(N),2),M=o(N,4);Bt(M,21,()=>d,Yt,(C,w)=>{var k=yl(),I=i(k),J=o(I,2),st=i(J),q=o(J,2),tt=i(q);R(()=>{g(st,r(w).icon),g(tt,r(w).label)}),Li(I,()=>r(u)[r(w).key],at=>r(u)[r(w).key]=at),_(C,k)});var E=o(M,2),O=o(i(E),2),_t=o(E,2),rt=o(i(_t),2),dt=o(_t,2),Wt=i(dt);{var Kt=C=>{var w=wl(),k=Qa(w);k.__click=[hl,c,b];var I=o(k,2);I.__click=[Wr,d,u,c,n,b],_(C,w)},Qt=C=>{var w=kl();w.__click=[Wr,d,u,c,n,b],_(C,w)};T(Wt,C=>{r(c)?C(Kt):C(Qt,!1)})}var it=o(h,2);{var va=C=>{var w=Fl(),k=i(w),I=i(k),J=o(i(I)),st=i(J),q=o(I,2);Bt(q,5,l,Yt,(tt,at)=>{var Ct=Ml(),St=i(Ct),Xt=i(St),aa=i(Xt),mt=o(Xt,2),nt=i(mt);{var sa=m=>{var z=zl();_(m,z)};T(nt,m=>{r(at).pianoLavoro&&m(sa)})}var Gt=o(nt,2);{var Jt=m=>{var z=$l();_(m,z)};T(Gt,m=>{r(at).lavello&&m(Jt)})}var B=o(Gt,2);{var yt=m=>{var z=Pl();_(m,z)};T(B,m=>{r(at).tagliaverdure&&m(yt)})}var wt=o(B,2);{var K=m=>{var z=Sl();_(m,z)};T(wt,m=>{r(at).spazzaturaPavimento&&m(K)})}var W=o(wt,2);{var lt=m=>{var z=Tl();_(m,z)};T(W,m=>{r(at).lavaggioPavimentoDetergente&&m(lt)})}var Tt=o(W,2);{var jt=m=>{var z=Al();_(m,z)};T(Tt,m=>{r(at).disidratatore&&m(jt)})}var ia=o(Tt,2);{var Ut=m=>{var z=El();_(m,z)};T(ia,m=>{r(at).ceste&&m(Ut)})}var et=o(ia,2);{var Mt=m=>{var z=Dl();_(m,z)};T(et,m=>{r(at).retine&&m(Mt)})}var ea=o(et,2);{var Vt=m=>{var z=Ll();_(m,z)};T(ea,m=>{r(at).controlloRagnatele&&m(Vt)})}var S=o(mt,2);{var F=m=>{var z=Cl(),Q=i(z);R(()=>g(Q,r(at).note)),_(m,z)};T(S,m=>{r(at).note&&m(F)})}var V=o(St,2),U=i(V);U.__click=[Il,v,at];var ft=o(U,2);ft.__click=[Ol,f,at],R(m=>g(aa,m),[()=>qa(r(at).data)]),_(tt,Ct)}),R(()=>g(st,l().length)),_(C,w)},ra=C=>{var w=Nl();_(C,w)};T(it,C=>{l().length>0?C(va):C(ra,!1)})}R(()=>g(A,`üßπ ${r(c)?"Modifica Pulizia":"Registrazione Pulizia"}`)),pt(D,()=>r(u).data,C=>r(u).data=C),pt(O,()=>r(u).prodottoUtilizzato,C=>r(u).prodottoUtilizzato=C),pt(rt,()=>r(u).note,C=>r(u).note=C),_(t,p),Sa(),s()}Ma(["click"]);var Kl=(t,a,e)=>a(r(e)),jl=(t,a,e)=>a(r(e).id),Ul=x('<div class="flex justify-between items-center p-3 bg-base-200/50 rounded-lg"><div><p class="font-medium"> </p> <p class="text-xs text-base-content/50"> </p></div> <div class="flex gap-1"><button class="btn btn-primary btn-xs">üì•</button> <button class="btn btn-ghost btn-xs text-error">üóëÔ∏è</button></div></div>'),Vl=x('<div class="card bg-base-100 shadow"><div class="card-body p-4"><h3 class="font-semibold flex items-center gap-2">üìÅ Archivio Report <span class="badge badge-ghost badge-sm"> </span></h3> <div class="space-y-2 mt-3 max-h-64 overflow-y-auto"></div></div></div>'),Hl=x('<div class="text-center py-8 text-base-content/50"><p class="text-4xl mb-2">üìÅ</p> <p>Nessun report archiviato</p> <p class="text-xs mt-1">Clicca "Genera PDF" per creare il primo report</p></div>'),Yl=x('<div class="space-y-4"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-info rounded-full"></div> <h2 class="text-lg font-bold">Report</h2></div> <div class="card bg-base-100 shadow-lg"><div class="card-body"><div class="flex justify-between items-start"><div><h3 class="card-title text-info">üìà Report Settimanale</h3> <p class="text-sm text-base-content/60"></p> <p class="text-xs text-base-content/40"> </p></div> <span class="badge badge-info badge-lg"></span></div> <div class="stats stats-vertical shadow mt-4 w-full"><div class="stat"><div class="stat-figure text-warning"><span class="text-3xl">üîÑ</span></div> <div class="stat-title">Lavorazioni</div> <div class="stat-value"> </div> <div class="stat-desc"> </div></div> <div class="stat"><div class="stat-figure text-primary"><span class="text-3xl">üë∑</span></div> <div class="stat-title">Ore Manodopera</div> <div class="stat-value text-primary"> </div></div> <div class="stat"><div class="stat-figure text-secondary"><span class="text-3xl">‚ö°</span></div> <div class="stat-title">Ore Disidratatore</div> <div class="stat-value text-secondary"> </div></div> <div class="stat"><div class="stat-figure text-accent"><span class="text-3xl">ü•¨</span></div> <div class="stat-title">Produzione</div> <div class="stat-value text-accent"> </div> <div class="stat-desc"> </div></div> <div class="stat"><div class="stat-figure text-warning"><span class="text-3xl">üßπ</span></div> <div class="stat-title">Pulizie HACCP</div> <div class="stat-value"> </div></div></div> <div class="card-actions justify-end mt-4"><button class="btn btn-outline btn-info">üìß Invia Email</button> <button class="btn btn-info">üìÑ Genera PDF</button></div></div></div> <!> <div class="card bg-gradient-to-br from-primary/10 to-secondary/10 shadow"><div class="card-body p-4"><h3 class="font-semibold"></h3> <div class="grid grid-cols-2 gap-4 mt-3"><div class="text-center"><p class="text-2xl font-bold text-primary"> </p> <p class="text-xs text-base-content/60">üë∑ Ore Manodopera</p></div> <div class="text-center"><p class="text-2xl font-bold text-secondary"> </p> <p class="text-xs text-base-content/60">‚ö° Ore Macchina</p></div> <div class="text-center"><p class="text-2xl font-bold text-success"> </p> <p class="text-xs text-base-content/60">‚úÖ Lavorazioni</p></div> <div class="text-center"><p class="text-2xl font-bold text-info"> </p> <p class="text-xs text-base-content/60">üì¶ Lotti Creati</p></div></div></div></div></div>');function Bl(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt(Aa,"$lavorazioni",e),n=()=>Lt(ve,"$pulizie",e),c=()=>Lt(pe,"$reportPdf",e),u=()=>Lt(ze,"$stats",e);Ca(a,"onreload",3,null);function d(P){const $=new Date(P);$.setHours(0,0,0,0),$.setDate($.getDate()+4-($.getDay()||7));const G=new Date($.getFullYear(),0,1);return Math.ceil((($-G)/864e5+1)/7)}const v=new Date,b=d(v),f=v.getFullYear();let p=Rt(()=>{const P=new Date(v);return P.setDate(P.getDate()-P.getDay()+1),P.setHours(0,0,0,0),P}),h=Rt(()=>{const P=new Date(r(p));return P.setDate(P.getDate()+6),P.setHours(23,59,59,999),P}),y=Rt(()=>l().filter(P=>{const $=new Date(P.dataInizio);return $>=r(p)&&$<=r(h)})),L=Rt(()=>n().filter(P=>{const $=new Date(P.data);return $>=r(p)&&$<=r(h)})),A=Rt(()=>({lavorazioni:r(y).length,completate:r(y).filter(P=>P.completata).length,oreManodopera:r(y).reduce((P,$)=>P+(parseFloat($.oreManooperaTotali)||0),0),oreMacchina:r(y).reduce((P,$)=>P+(parseFloat($.oreMacchinaTotali)||0),0),kgFreschi:r(y).reduce((P,$)=>P+($.prodotti||[]).reduce((G,j)=>G+(parseFloat(j.kgAcquistati)||0),0),0),kgSecchi:r(y).reduce((P,$)=>P+($.prodotti||[]).reduce((G,j)=>G+(parseFloat(j.kgSecco)||0),0),0),pulizie:r(L).length}));async function N(){xt.set(!0),qt.set("Generazione e invio report...");try{const P=await gt.inviaReportEmail();ca("Report inviato via email e salvato!");const $=await gt.getReportPdf();pe.set($)}catch(P){Ht(P.message)}finally{xt.set(!1),qt.set("")}}async function D(){xt.set(!0),qt.set("Generazione PDF...");try{const P=await gt.inviaReportEmail();ca("PDF generato e salvato!");const $=await gt.getReportPdf();pe.set($)}catch(P){Ht(P.message)}finally{xt.set(!1),qt.set("")}}function M(P){const $=gt.getReportPdfUrl(P.id);window.open($,"_blank")}async function E(P){if(confirm("Eliminare questo report?"))try{await gt.eliminaReportPdf(P),pe.update($=>$.filter(G=>G.id!==P)),ca("Report eliminato")}catch($){Ht($.message)}}var O=Yl(),_t=o(i(O),2),rt=i(_t),dt=i(rt),Wt=i(dt),Kt=o(i(Wt),2);Kt.textContent=`Settimana ${b??""}/${f??""}`;var Qt=o(Kt,2),it=i(Qt),va=o(Wt,2);va.textContent=`W${b??""}`;var ra=o(dt,2),C=i(ra),w=o(i(C),4),k=i(w),I=o(w,2),J=i(I),st=o(C,2),q=o(i(st),4),tt=i(q),at=o(st,2),Ct=o(i(at),4),St=i(Ct),Xt=o(at,2),aa=o(i(Xt),4),mt=i(aa),nt=o(aa,2),sa=i(nt),Gt=o(Xt,2),Jt=o(i(Gt),4),B=i(Jt),yt=o(ra,2),wt=i(yt);wt.__click=N;var K=o(wt,2);K.__click=D;var W=o(_t,2);{var lt=P=>{var $=Vl(),G=i($),j=i(G),ct=o(i(j)),kt=i(ct),At=o(j,2);Bt(At,5,c,Yt,(Ft,Z)=>{var bt=Ul(),ot=i(bt),zt=i(ot),X=i(zt),$t=o(zt,2),vt=i($t),Nt=o(ot,2),Zt=i(Nt);Zt.__click=[Kl,M,Z];var ut=o(Zt,2);ut.__click=[jl,E,Z],R(Pt=>{g(X,r(Z).nomeFile),g(vt,`Settimana ${r(Z).settimana??""}/${r(Z).anno??""} ‚Ä¢ ${Pt??""}`)},[()=>Fi(r(Z).dataCreazione)]),_(Ft,bt)}),R(()=>g(kt,c().length)),_(P,$)},Tt=P=>{var $=Hl();_(P,$)};T(W,P=>{c().length>0?P(lt):P(Tt,!1)})}var jt=o(W,2),ia=i(jt),Ut=i(ia);Ut.textContent=`üìä Statistiche Anno ${f??""}`;var et=o(Ut,2),Mt=i(et),ea=i(Mt),Vt=i(ea),S=o(Mt,2),F=i(S),V=i(F),U=o(S,2),ft=i(U),m=i(ft),z=o(U,2),Q=i(z),H=i(Q);R((P,$,G,j,ct,kt,At,Ft)=>{g(it,`${P??""} - ${$??""}`),g(k,r(A).lavorazioni),g(J,`${r(A).completate??""} completate`),g(tt,G),g(St,j),g(mt,`${ct??""} kg`),g(sa,`${kt??""} kg freschi lavorati`),g(B,r(A).pulizie),g(Vt,At),g(V,Ft),g(m,u().completate),g(H,u().lottiTotali)},[()=>qa(r(p)),()=>qa(r(h)),()=>Ja(r(A).oreManodopera),()=>Ja(r(A).oreMacchina),()=>ta(r(A).kgSecchi),()=>ta(r(A).kgFreschi),()=>Ja(u().oreManodoperaAnno),()=>Ja(u().oreMacchinaAnno)]),_(t,O),Sa(),s()}Ma(["click"]);var Gl=x('<div class="space-y-4"><div class="flex items-center gap-2 lg:hidden"><div class="w-1 h-6 bg-neutral rounded-full"></div> <h2 class="text-lg font-bold">Impostazioni</h2></div> <div class="card bg-base-100 shadow-lg"><div class="card-body"><h3 class="card-title">üí∞ Parametri Calcolo Costi</h3> <p class="text-sm text-base-content/60">Questi parametri vengono usati per calcolare automaticamente i costi delle lavorazioni.</p> <div class="divider text-sm">Costi orari</div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-4"><div class="form-control"><label class="label"><span class="label-text">üë∑ ‚Ç¨/ora Manodopera</span></label> <input type="number" step="0.5" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">‚ö° ‚Ç¨/ora Disidratatore 40</span></label> <input type="number" step="0.01" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">‚ö° ‚Ç¨/ora Disidratatore 100</span></label> <input type="number" step="0.01" class="input input-bordered"/></div></div> <div class="divider text-sm">Margini e tasse</div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-4"><div class="form-control"><label class="label"><span class="label-text">üìà Margine %</span></label> <input type="number" step="1" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">üèõÔ∏è Aliquota IVA %</span></label> <input type="number" step="1" class="input input-bordered"/></div> <div class="form-control"><label class="label"><span class="label-text">‚ûï Costi Extra ‚Ç¨</span></label> <input type="number" step="0.5" class="input input-bordered"/></div></div> <div class="card-actions justify-between mt-6"><button class="btn btn-ghost">üîÑ Reset Default</button> <button class="btn btn-primary">üíæ Salva Parametri</button></div></div></div> <div class="card bg-base-100 shadow"><div class="card-body p-4"><h3 class="font-semibold">‚ÑπÔ∏è Informazioni App</h3> <div class="space-y-2 mt-2 text-sm"><div class="flex justify-between"><span class="text-base-content/60">Versione</span> <span class="font-mono">1.0.0</span></div> <div class="flex justify-between"><span class="text-base-content/60">Framework</span> <span>Svelte 5 + DaisyUI</span></div> <div class="flex justify-between"><span class="text-base-content/60">Backend</span> <span>Cloudflare Workers + D1</span></div></div></div></div> <div class="card bg-gradient-to-br from-info/10 to-primary/10 shadow"><div class="card-body p-4"><h3 class="font-semibold">üìê Formula Calcolo Costi</h3> <div class="text-sm space-y-2 mt-2 font-mono bg-base-200 p-3 rounded-lg"><p>1Ô∏è‚É£ Costo Produzione = Manodopera + Energia + Extra</p> <p>2Ô∏è‚É£ % Prodotto = Kg Secchi Prodotto / Kg Secchi Totali</p> <p>3Ô∏è‚É£ Quota Produzione = Costo Prod. √ó % Prodotto</p> <p>4Ô∏è‚É£ Costo MP = ‚Ç¨/kg MP √ó Kg Freschi</p> <p>5Ô∏è‚É£ Costo Totale = Quota Prod. + Costo MP</p> <p>6Ô∏è‚É£ Prezzo = Costo √ó (1 + Margine%) √ó (1 + IVA%)</p></div> <p class="text-xs text-base-content/50 mt-2">‚ö†Ô∏è La ripartizione √® basata sui <strong>kg SECCHI</strong>, non freschi!</p></div></div></div>');function Jl(t,a){Pa(a,!0);const[e,s]=Ta();let n=ht(fa({...Lt(xe,"$parametriCosti",e)}));function c(){xe.set(r(n)),ca("Parametri salvati!")}function u(){Y(n,{costoOraManodopera:15,costoOraDisidratatore40:.9,costoOraDisidratatore100:1.9,marginePercentuale:30,aliquotaIVA:4,costiExtra:0},!0),xe.set(r(n)),ca("Parametri resettati ai valori default")}var d=Gl(),v=o(i(d),2),b=i(v),f=o(i(b),6),p=i(f),h=o(i(p),2),y=o(p,2),L=o(i(y),2),A=o(y,2),N=o(i(A),2),D=o(f,4),M=i(D),E=o(i(M),2),O=o(M,2),_t=o(i(O),2),rt=o(O,2),dt=o(i(rt),2),Wt=o(D,2),Kt=i(Wt);Kt.__click=u;var Qt=o(Kt,2);Qt.__click=c,pt(h,()=>r(n).costoOraManodopera,it=>r(n).costoOraManodopera=it),pt(L,()=>r(n).costoOraDisidratatore40,it=>r(n).costoOraDisidratatore40=it),pt(N,()=>r(n).costoOraDisidratatore100,it=>r(n).costoOraDisidratatore100=it),pt(E,()=>r(n).marginePercentuale,it=>r(n).marginePercentuale=it),pt(_t,()=>r(n).aliquotaIVA,it=>r(n).aliquotaIVA=it),pt(dt,()=>r(n).costiExtra,it=>r(n).costiExtra=it),_(t,d),Sa(),s()}Ma(["click"]);var Wl=x('<div class="flex flex-col justify-center items-center h-64 gap-4"><span class="loading loading-spinner loading-lg text-primary"></span> <p class="text-base-content/60">Caricamento...</p></div>'),Ql=x('<div class="animate-fade-in"><!></div>'),Xl=x('<div class="min-h-screen bg-gradient-to-br from-green-50/50 via-white to-amber-50/50"><div class="lg:hidden"><!></div> <div class="hidden lg:block"><!></div> <main class="lg:ml-64 min-h-screen"><div class="hidden lg:block sticky top-0 z-40 bg-base-100/80 backdrop-blur-lg border-b border-base-200"><div class="px-6 py-4 flex justify-between items-center"><h1 class="text-xl font-bold text-base-content"><!></h1> <div class="flex items-center gap-3"><div><div></div> </div></div></div></div> <div class="container mx-auto px-4 py-4 pb-24 lg:pb-8 max-w-4xl"><!></div></main> <div class="lg:hidden"><!></div> <!> <!></div>');function Zl(t,a){Pa(a,!0);const[e,s]=Ta(),l=()=>Lt($a,"$currentTab",e),n=()=>Lt(me,"$isOnline",e);let c=ht(!0);on(async()=>{window.addEventListener("online",()=>me.set(!0)),window.addEventListener("offline",()=>me.set(!1)),await u(),Y(c,!1)});async function u(){xt.set(!0),qt.set("Caricamento dati...");try{const[w,k,I,J,st]=await Promise.allSettled([gt.getLavorazioni(),gt.getLotti(),gt.getPulizie(),gt.getInventari(),gt.getReportPdf()]);Aa.set(w.status==="fulfilled"?w.value:[]),Na.set(k.status==="fulfilled"?k.value:[]),ve.set(I.status==="fulfilled"?I.value:[]),sn.set(J.status==="fulfilled"?J.value:[]),pe.set(st.status==="fulfilled"?st.value:[])}catch(w){console.error("Errore caricamento dati:",w),ce.set("Errore nel caricamento dei dati")}finally{xt.set(!1),qt.set("")}}typeof window<"u"&&(window.reloadData=u);var d=Xl(),v=i(d),b=i(v);vn(b);var f=o(v,2),p=i(f);_n(p,{});var h=o(f,2),y=i(h),L=i(y),A=i(L),N=i(A);{var D=w=>{var k=ua("üìä Dashboard");_(w,k)},M=(w,k)=>{{var I=st=>{var q=ua("‚ú® Lavorazioni");_(st,q)},J=(st,q)=>{{var tt=Ct=>{var St=ua("üì¶ Lotti");_(Ct,St)},at=(Ct,St)=>{{var Xt=mt=>{var nt=ua("üßπ Pulizie HACCP");_(mt,nt)},aa=(mt,nt)=>{{var sa=Jt=>{var B=ua("üìà Report");_(Jt,B)},Gt=(Jt,B)=>{{var yt=wt=>{var K=ua("‚öôÔ∏è Impostazioni");_(wt,K)};T(Jt,wt=>{l()==="impostazioni"&&wt(yt)},B)}};T(mt,Jt=>{l()==="report"?Jt(sa):Jt(Gt,!1)},nt)}};T(Ct,mt=>{l()==="pulizie"?mt(Xt):mt(aa,!1)},St)}};T(st,Ct=>{l()==="lotti"?Ct(tt):Ct(at,!1)},q)}};T(w,st=>{l()==="nuova"?st(I):st(J,!1)},k)}};T(N,w=>{l()==="home"?w(D):w(M,!1)})}var E=o(A,2),O=i(E),_t=i(O),rt=o(_t),dt=o(y,2),Wt=i(dt);{var Kt=w=>{var k=Wl();_(w,k)},Qt=w=>{var k=Ql(),I=i(k);{var J=q=>{Wn(q,{onreload:u})},st=(q,tt)=>{{var at=St=>{Ps(St,{onreload:u})},Ct=(St,Xt)=>{{var aa=nt=>{xl(nt,{onreload:u})},mt=(nt,sa)=>{{var Gt=B=>{ql(B,{onreload:u})},Jt=(B,yt)=>{{var wt=W=>{Bl(W,{onreload:u})},K=(W,lt)=>{{var Tt=jt=>{Jl(jt,{})};T(W,jt=>{l()==="impostazioni"&&jt(Tt)},lt)}};T(B,W=>{l()==="report"?W(wt):W(K,!1)},yt)}};T(nt,B=>{l()==="pulizie"?B(Gt):B(Jt,!1)},sa)}};T(St,nt=>{l()==="lotti"?nt(aa):nt(mt,!1)},Xt)}};T(q,St=>{l()==="nuova"?St(at):St(Ct,!1)},tt)}};T(I,q=>{l()==="home"?q(J):q(st,!1)})}_(w,k)};T(Wt,w=>{r(c)?w(Kt):w(Qt,!1)})}var it=o(h,2),va=i(it);xn(va,{});var ra=o(it,2);kn(ra,{});var C=o(ra,2);$n(C),R(()=>{na(O,1,`badge ${n()?"badge-success":"badge-error"} gap-1`),na(_t,1,`w-2 h-2 rounded-full ${n()?"bg-green-200":"bg-red-200"} animate-pulse`),g(rt,` ${n()?"Online":"Offline"}`)}),_(t,d),Sa(),s()}qo(Zl,{target:document.getElementById("app")});
